[clevor@clevor-laptop-nixos:/tmp/clevor]$ mkdir test
[clevor@clevor-laptop-nixos:/tmp/clevor]$ cd test
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ nix shell github:myclevorname/narser/d5990886b3af7eb081a2fdba41a3c8c08e7372d9 github:NixOS/nix/18c3d2348f59032f1c630e6a232fe3637efb8200
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ git clone https://github.com/torvalds/linux --depth=1
Cloning into 'linux'...
remote: Enumerating objects: 95867, done.
remote: Counting objects: 100% (95867/95867), done.
remote: Compressing objects: 100% (85837/85837), done.
remote: Total 95867 (delta 10066), reused 70884 (delta 9015), pack-reused 0 (from 0)
Receiving objects: 100% (95867/95867), 265.56 MiB | 16.73 MiB/s, done.
Resolving deltas: 100% (10066/10066), done.
Updating files: 100% (90500/90500), done.
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ cmp <(nix nar pack linux) <(narser pack linux)
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ poop "nix nar pack linux" "narser pack linux"
Benchmark 1 (3 runs): nix nar pack linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.90s  Â± 6.63ms    1.90s  â€¦ 1.91s           0 ( 0%)        0%
  peak_rss           41.1MB Â±  125KB    41.0MB â€¦ 41.2MB          0 ( 0%)        0%
  cpu_cycles         3.42G  Â± 19.1M     3.40G  â€¦ 3.44G           0 ( 0%)        0%
  instructions       7.36G  Â±  340K     7.36G  â€¦ 7.36G           0 ( 0%)        0%
  cache_references   61.0M  Â± 2.19M     58.9M  â€¦ 63.3M           0 ( 0%)        0%
  cache_misses       4.38M  Â± 49.7K     4.34M  â€¦ 4.43M           0 ( 0%)        0%
  branch_misses      8.86M  Â±  390K     8.62M  â€¦ 9.31M           0 ( 0%)        0%
Benchmark 2 (7 runs): narser pack linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           785ms Â± 1.87ms     783ms â€¦  789ms          0 ( 0%)        âš¡- 58.7% Â±  0.3%
  peak_rss           7.06MB Â± 64.0KB    6.96MB â€¦ 7.09MB          0 ( 0%)        âš¡- 82.8% Â±  0.3%
  cpu_cycles          331M  Â± 1.38M      329M  â€¦  332M           0 ( 0%)        âš¡- 90.3% Â±  0.4%
  instructions        519M  Â±  242       519M  â€¦  519M           0 ( 0%)        âš¡- 92.9% Â±  0.0%
  cache_references   25.6M  Â±  424K     25.1M  â€¦ 26.3M           0 ( 0%)        âš¡- 58.0% Â±  3.0%
  cache_misses       3.21M  Â± 63.6K     3.10M  â€¦ 3.29M           0 ( 0%)        âš¡- 26.6% Â±  2.2%
  branch_misses      1.12M  Â± 3.02K     1.12M  â€¦ 1.12M           0 ( 0%)        âš¡- 87.4% Â±  3.5%
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ cmp <(nix hash path linux) <(narser hash linux)
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ poop "nix hash path linux" "narser hash linux"
Benchmark 1 (3 runs): nix hash path linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          6.03s  Â± 69.7ms    5.95s  â€¦ 6.08s           0 ( 0%)        0%
  peak_rss           41.1MB Â± 82.4KB    41.1MB â€¦ 41.2MB          0 ( 0%)        0%
  cpu_cycles         17.9G  Â±  238M     17.6G  â€¦ 18.0G           0 ( 0%)        0%
  instructions       58.7G  Â±  157K     58.7G  â€¦ 58.7G           0 ( 0%)        0%
  cache_references   87.8M  Â± 5.43M     82.9M  â€¦ 93.6M           0 ( 0%)        0%
  cache_misses       4.64M  Â± 38.4K     4.61M  â€¦ 4.68M           0 ( 0%)        0%
  branch_misses      14.8M  Â± 5.33M     8.63M  â€¦ 18.2M           0 ( 0%)        0%
Benchmark 2 (3 runs): narser hash linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          9.07s  Â± 18.3ms    9.05s  â€¦ 9.09s           0 ( 0%)        ðŸ’©+ 50.3% Â±  1.9%
  peak_rss           7.01MB Â± 75.7KB    6.96MB â€¦ 7.09MB          0 ( 0%)        âš¡- 83.0% Â±  0.4%
  cpu_cycles         26.8G  Â± 41.7M     26.7G  â€¦ 26.8G           0 ( 0%)        ðŸ’©+ 50.0% Â±  2.2%
  instructions       97.7G  Â± 95.6      97.7G  â€¦ 97.7G           0 ( 0%)        ðŸ’©+ 66.4% Â±  0.0%
  cache_references   30.1M  Â± 1.23M     28.7M  â€¦ 31.1M           0 ( 0%)        âš¡- 65.8% Â± 10.2%
  cache_misses       3.86M  Â±  285K     3.68M  â€¦ 4.19M           0 ( 0%)        âš¡- 16.8% Â±  9.9%
  branch_misses      2.37M  Â±  122K     2.26M  â€¦ 2.50M           0 ( 0%)        âš¡- 84.0% Â± 57.8%
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ # I think the slowness is due to the Zig standard library's SHA256 implementation
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ narser pack linux > linux.nar
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ wc -c linux.nar 
1837577096 linux.nar
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ cmp <(nix nar ls linux.nar /) <(narser ls linux.nar /)
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ cmp <(nix nar ls linux.nar / -R) <(narser ls linux.nar / -R)
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ cmp <(nix nar ls linux.nar / -Rl) <(narser ls linux.nar / -Rl)
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ cmp <(nix nar ls linux.nar / -l) <(narser ls linux.nar / -l)
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ poop "nix nar ls linux.nar / -lR" "narser ls linux.nar / -lR"
Benchmark 1 (3 runs): nix nar ls linux.nar / -lR
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.96s  Â± 19.0ms    2.94s  â€¦ 2.97s           0 ( 0%)        0%
  peak_rss           3.75GB Â± 41.0KB    3.75GB â€¦ 3.75GB          0 ( 0%)        0%
  cpu_cycles         3.16G  Â± 33.6M     3.14G  â€¦ 3.20G           0 ( 0%)        0%
  instructions       2.60G  Â±  528K     2.59G  â€¦ 2.60G           0 ( 0%)        0%
  cache_references    140M  Â± 1.27M      139M  â€¦  141M           0 ( 0%)        0%
  cache_misses       73.6M  Â±  188K     73.4M  â€¦ 73.8M           0 ( 0%)        0%
  branch_misses      4.87M  Â±  669K     4.34M  â€¦ 5.62M           0 ( 0%)        0%
Benchmark 2 (4 runs): narser ls linux.nar / -lR
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.40s  Â± 4.55ms    1.39s  â€¦ 1.40s           1 (25%)        âš¡- 52.8% Â±  0.8%
  peak_rss           1.85GB Â±    0      1.85GB â€¦ 1.85GB          0 ( 0%)        âš¡- 50.8% Â±  0.0%
  cpu_cycles         1.07G  Â± 1.25M     1.06G  â€¦ 1.07G           1 (25%)        âš¡- 66.3% Â±  1.3%
  instructions        825M  Â± 92.1       825M  â€¦  825M           0 ( 0%)        âš¡- 68.2% Â±  0.0%
  cache_references   75.0M  Â± 16.3K     75.0M  â€¦ 75.0M           0 ( 0%)        âš¡- 46.4% Â±  1.1%
  cache_misses       43.3M  Â± 25.8K     43.3M  â€¦ 43.3M           1 (25%)        âš¡- 41.1% Â±  0.3%
  branch_misses       483K  Â±  498       483K  â€¦  484K           0 ( 0%)        âš¡- 90.1% Â± 17.1%
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ poop "nix nar cat linux.nar /README" "narser cat linux.nar /README"
Benchmark 1 (3 runs): nix nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.54s  Â± 4.81ms    2.54s  â€¦ 2.55s           0 ( 0%)        0%
  peak_rss           3.73GB Â±  122KB    3.73GB â€¦ 3.73GB          0 ( 0%)        0%
  cpu_cycles         2.44G  Â± 3.82M     2.44G  â€¦ 2.45G           0 ( 0%)        0%
  instructions       1.14G  Â±  139K     1.13G  â€¦ 1.14G           0 ( 0%)        0%
  cache_references    126M  Â±  401K      126M  â€¦  127M           0 ( 0%)        0%
  cache_misses       69.8M  Â± 66.8K     69.8M  â€¦ 69.9M           0 ( 0%)        0%
  branch_misses      1.90M  Â± 8.95K     1.89M  â€¦ 1.91M           0 ( 0%)        0%
Benchmark 2 (4 runs): narser cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.34s  Â± 10.4ms    1.33s  â€¦ 1.36s           0 ( 0%)        âš¡- 47.2% Â±  0.7%
  peak_rss           1.85GB Â±    0      1.85GB â€¦ 1.85GB          0 ( 0%)        âš¡- 50.5% Â±  0.0%
  cpu_cycles          961M  Â± 1.19M      959M  â€¦  962M           1 (25%)        âš¡- 60.7% Â±  0.2%
  instructions        613M  Â±  174       613M  â€¦  613M           0 ( 0%)        âš¡- 46.0% Â±  0.0%
  cache_references   73.6M  Â± 73.2K     73.5M  â€¦ 73.7M           0 ( 0%)        âš¡- 41.8% Â±  0.4%
  cache_misses       42.4M  Â± 6.97K     42.4M  â€¦ 42.5M           0 ( 0%)        âš¡- 39.2% Â±  0.1%
  branch_misses       286K  Â±  623       285K  â€¦  287K           0 ( 0%)        âš¡- 85.0% Â±  0.6%
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ narser unpack linux.nar out
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ cmp <(nix nar pack out) linux.nar
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ rm -rf out ; time nix-store --restore out < linux.nar

real	0m1.591s
user	0m0.358s
sys	0m1.227s
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ rm -rf out ; time nix-store --restore out < linux.nar

real	0m1.609s
user	0m0.356s
sys	0m1.244s
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ rm -rf out ; time nix-store --restore out < linux.nar

real	0m1.596s
user	0m0.344s
sys	0m1.246s
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ rm -rf out ; time narser unpack linux.nar out

real	0m1.619s
user	0m0.367s
sys	0m1.240s
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ rm -rf out ; time narser unpack linux.nar out

real	0m1.604s
user	0m0.359s
sys	0m1.239s
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ rm -rf out ; time narser unpack linux.nar out

real	0m1.616s
user	0m0.348s
sys	0m1.261s
[clevor@clevor-laptop-nixos:/tmp/clevor/test]$ cd linux/
[clevor@clevor-laptop-nixos:/tmp/clevor/test/linux]$ git log
commit c8bc81a52d5a2ac2e4b257ae123677cf94112755 (grafted, HEAD -> master, origin/master, origin/HEAD)
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Sat Aug 30 10:43:53 2025 -0700

    Merge tag 'arm64-fixes' of git://git.kernel.org/pub/scm/linux/kernel/git/arm64/linux
    
    Pull arm64 fixes from Catalin Marinas:
    
     - CFI failure due to kpti_ng_pgd_alloc() signature mismatch
    
     - Underallocation bug in the SVE ptrace kselftest
    
    * tag 'arm64-fixes' of git://git.kernel.org/pub/scm/linux/kernel/git/arm64/linux:
      kselftest/arm64: Don't open code SVE_PT_SIZE() in fp-ptrace
      arm64: mm: Fix CFI failure due to kpti_ng_pgd_alloc function signature
