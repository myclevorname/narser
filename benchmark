
echo $1
/tmp/clevor/tests

mkdir $1 || exit 1
cd $1

nix build git+https://git.lix.systems/lix-project/lix?rev=f4bdddf0fdaabc68546cf561c5343b83d95d2466 -o lix >& /dev/null || exit 1
nix build github:NixOS/nix/dbc235cc62b0f26d459c1df7b4659ff15abdc718 -o nix >& /dev/null || exit 1
nix build github:water-sucks/narz/760736b98e08c7c741838f5ad020d6d2e33b5e57 -o narz >& /dev/null || exit 1
nix build github:myclevorname/narser/bf7fe48ab40e9f8d5e1823259a70106d1bfada78 -o narser >& /dev/null || exit 1

git clone https://github.com/torvalds/linux --depth=1 -q
cd linux
git log | head
commit 76eeb9b8de9880ca38696b2fb56ac45ac0a25c6c
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Sun Sep 7 14:22:57 2025 -0700

    Linux 6.17-rc5
cd ..

nix nar pack linux > linux.nar

cmp <(./nix/bin/nix nar pack linux) <(./lix/bin/nix nar dump-path linux)
cmp <(./nix/bin/nix nar pack linux) <(./narser/bin/narser pack linux) || exit 1

cmp <(./nix/bin/nix nar cat linux.nar /README) <(./lix/bin/nix nar cat linux.nar /README)
cmp <(./nix/bin/nix nar cat linux.nar /README) <(./narser/bin/narser cat linux.nar /README) || exit 1
cmp <(./nix/bin/nix nar cat linux.nar /README) <(./narz/bin/narz cat linux.nar /README)

cmp <(./nix/bin/nix nar ls linux.nar /) <(./lix/bin/nix nar ls linux.nar /)
cmp <(./nix/bin/nix nar ls linux.nar /) <(./narser/bin/narser ls linux.nar /) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar /) <(./narz/bin/narz ls linux.nar / 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 1, line 1

cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./lix/bin/nix nar ls linux.nar / -l)
cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./narser/bin/narser ls linux.nar / -l) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./narz/bin/narz ls linux.nar / -l 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 1, line 1

cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./lix/bin/nix nar ls linux.nar / -lR)
cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./narser/bin/narser ls linux.nar / -lR) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./narz/bin/narz ls linux.nar / -lr 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 3, line 1

cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./lix/bin/nix nar ls linux.nar / -R)
error: writing to file: Broken pipe
cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./narser/bin/narser ls linux.nar / -R) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./narz/bin/narz ls linux.nar / -r 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 2, line 1

poop "./nix/bin/nix nar pack linux" "./lix/bin/nix nar dump-path linux" "./narser/bin/narser pack linux"
error: writing to file: Broken pipe
Benchmark 1 (3 runs): ./nix/bin/nix nar pack linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.93s  Â± 8.07ms                              1.92s  â€¦ 1.94s                                     0 ( 0%)        0%
  peak_rss           41.0MB Â± 70.9KB                              40.9MB â€¦ 41.1MB                                    0 ( 0%)        0%
  cpu_cycles         3.47G  Â± 31.6M                               3.43G  â€¦ 3.50G                                     0 ( 0%)        0%
  instructions       7.40G  Â±  238K                               7.39G  â€¦ 7.40G                                     0 ( 0%)        0%
  cache_references   59.8M  Â± 4.86M                               56.1M  â€¦ 65.3M                                     0 ( 0%)        0%
  cache_misses       4.50M  Â±  239K                               4.35M  â€¦ 4.78M                                     0 ( 0%)        0%
  branch_misses      9.46M  Â± 1.07M                               8.52M  â€¦ 10.6M                                     0 ( 0%)        0%
Benchmark 2 (5 runs): ./lix/bin/nix nar dump-path linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.15s  Â± 5.52ms                              1.15s  â€¦ 1.16s                                     0 ( 0%)        âš¡- 40.2% Â±  0.6%
  peak_rss           33.7MB Â± 57.8KB                              33.7MB â€¦ 33.8MB                                    0 ( 0%)        âš¡- 17.8% Â±  0.3%
  cpu_cycles         1.30G  Â± 11.1M                               1.28G  â€¦ 1.31G                                     0 ( 0%)        âš¡- 62.6% Â±  1.0%
  instructions       1.81G  Â± 7.19K                               1.81G  â€¦ 1.81G                                     0 ( 0%)        âš¡- 75.5% Â±  0.0%
  cache_references   80.6M  Â± 3.06M                               77.7M  â€¦ 84.4M                                     0 ( 0%)        ðŸ’©+ 34.7% Â± 11.2%
  cache_misses        772K  Â± 65.9K                                705K  â€¦  877K                                     0 ( 0%)        âš¡- 82.8% Â±  5.9%
  branch_misses      3.23M  Â±  132K                               3.06M  â€¦ 3.35M                                     0 ( 0%)        âš¡- 65.8% Â± 11.8%
Benchmark 3 (7 runs): ./narser/bin/narser pack linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           770ms Â± 3.41ms                               767ms â€¦  777ms                                    0 ( 0%)        âš¡- 60.1% Â±  0.4%
  peak_rss           7.70MB Â± 64.0KB                              7.60MB â€¦ 7.73MB                                    0 ( 0%)        âš¡- 81.2% Â±  0.3%
  cpu_cycles          293M  Â± 4.04M                                289M  â€¦  301M                                     0 ( 0%)        âš¡- 91.6% Â±  0.7%
  instructions        456M  Â±  355                                 456M  â€¦  456M                                     0 ( 0%)        âš¡- 93.8% Â±  0.0%
  cache_references   25.7M  Â± 1.62M                               24.6M  â€¦ 29.3M                                     0 ( 0%)        âš¡- 57.0% Â±  7.5%
  cache_misses       3.34M  Â±  154K                               3.16M  â€¦ 3.51M                                     0 ( 0%)        âš¡- 25.8% Â±  6.3%
  branch_misses      1.03M  Â± 2.19K                               1.02M  â€¦ 1.03M                                     0 ( 0%)        âš¡- 89.2% Â±  9.0%
poop "./nix/bin/nix nar ls linux.nar /" "./lix/bin/nix nar ls linux.nar /" "./narser/bin/narser ls linux.nar /" "./narz/bin/narz ls linux.nar /"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.57s  Â± 16.2ms                              2.55s  â€¦ 2.59s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â± 85.2KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.50G  Â± 20.7M                               2.47G  â€¦ 2.51G                                     0 ( 0%)        0%
  instructions       1.21G  Â± 47.4K                               1.21G  â€¦ 1.21G                                     0 ( 0%)        0%
  cache_references    127M  Â±  381K                                127M  â€¦  128M                                     0 ( 0%)        0%
  cache_misses       71.0M  Â±  154K                               70.8M  â€¦ 71.1M                                     0 ( 0%)        0%
  branch_misses      2.12M  Â±  338K                               1.73M  â€¦ 2.35M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.67s  Â± 12.5ms                              2.65s  â€¦ 2.67s                                     0 ( 0%)        ðŸ’©+  3.8% Â±  1.3%
  peak_rss           3.73GB Â± 56.5KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         2.89G  Â± 22.9M                               2.86G  â€¦ 2.91G                                     0 ( 0%)        ðŸ’©+ 15.7% Â±  2.0%
  instructions       2.16G  Â± 6.69K                               2.16G  â€¦ 2.16G                                     0 ( 0%)        ðŸ’©+ 79.1% Â±  0.0%
  cache_references    133M  Â± 6.04M                                129M  â€¦  140M                                     0 ( 0%)          +  4.5% Â±  7.6%
  cache_misses       70.1M  Â± 9.63K                               70.1M  â€¦ 70.1M                                     0 ( 0%)          -  1.2% Â±  0.3%
  branch_misses      4.28M  Â±  460K                               3.93M  â€¦ 4.80M                                     0 ( 0%)        ðŸ’©+102.0% Â± 43.1%
Benchmark 3 (16 runs): ./narser/bin/narser ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           319ms Â± 3.31ms                               311ms â€¦  324ms                                    2 (13%)        âš¡- 87.6% Â±  0.3%
  peak_rss            405MB Â± 44.8KB                               404MB â€¦  405MB                                    2 (13%)        âš¡- 89.2% Â±  0.0%
  cpu_cycles          214M  Â± 1.39M                                212M  â€¦  216M                                     0 ( 0%)        âš¡- 91.4% Â±  0.4%
  instructions        287M  Â±  333                                 287M  â€¦  287M                                     0 ( 0%)        âš¡- 76.2% Â±  0.0%
  cache_references   3.95M  Â±  218K                               3.63M  â€¦ 4.44M                                     0 ( 0%)        âš¡- 96.9% Â±  0.3%
  cache_misses       75.5K  Â± 5.33K                               68.5K  â€¦ 86.6K                                     0 ( 0%)        âš¡- 99.9% Â±  0.1%
  branch_misses       482K  Â± 2.61K                                478K  â€¦  487K                                     2 (13%)        âš¡- 77.3% Â±  7.3%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.72s  Â± 4.42ms                              3.71s  â€¦ 3.72s                                     0 ( 0%)        ðŸ’©+ 44.7% Â±  1.1%
  peak_rss           1.84GB Â± 75.7KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles          876M  Â± 6.80M                                871M  â€¦  883M                                     0 ( 0%)        âš¡- 64.9% Â±  1.4%
  instructions        864M  Â±  126                                 864M  â€¦  864M                                     0 ( 0%)        âš¡- 28.5% Â±  0.0%
  cache_references   4.50M  Â±  168K                               4.36M  â€¦ 4.68M                                     0 ( 0%)        âš¡- 96.5% Â±  0.5%
  cache_misses        122K  Â± 7.15K                                118K  â€¦  131K                                     0 ( 0%)        âš¡- 99.8% Â±  0.3%
  branch_misses      1.83M  Â± 39.8K                               1.79M  â€¦ 1.86M                                     0 ( 0%)          - 13.9% Â± 25.7%
poop "./nix/bin/nix nar ls linux.nar / -R" "./lix/bin/nix nar ls linux.nar / -R" "./narser/bin/narser ls linux.nar / -R" "./narz/bin/narz ls linux.nar / -r"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.78s  Â± 11.6ms                              2.77s  â€¦ 2.79s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â± 60.3KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.87G  Â± 18.5M                               2.86G  â€¦ 2.89G                                     0 ( 0%)        0%
  instructions       1.91G  Â± 1.05M                               1.91G  â€¦ 1.91G                                     0 ( 0%)        0%
  cache_references    138M  Â± 2.90M                                136M  â€¦  141M                                     0 ( 0%)        0%
  cache_misses       73.2M  Â±  236K                               73.1M  â€¦ 73.5M                                     0 ( 0%)        0%
  branch_misses      4.06M  Â±  360K                               3.78M  â€¦ 4.47M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.92s  Â± 20.9ms                              2.90s  â€¦ 2.94s                                     0 ( 0%)        ðŸ’©+  5.0% Â±  1.4%
  peak_rss           3.73GB Â± 61.3KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         3.36G  Â± 42.4M                               3.32G  â€¦ 3.40G                                     0 ( 0%)        ðŸ’©+ 17.0% Â±  2.6%
  instructions       3.01G  Â±  714K                               3.01G  â€¦ 3.01G                                     0 ( 0%)        ðŸ’©+ 57.7% Â±  0.1%
  cache_references    133M  Â±  738K                                132M  â€¦  133M                                     0 ( 0%)          -  3.7% Â±  3.5%
  cache_misses       71.1M  Â± 85.5K                               71.0M  â€¦ 71.2M                                     0 ( 0%)        âš¡-  2.9% Â±  0.5%
  branch_misses      5.80M  Â±  272K                               5.49M  â€¦ 5.98M                                     0 ( 0%)        ðŸ’©+ 42.9% Â± 17.8%
Benchmark 3 (15 runs): ./narser/bin/narser ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           344ms Â± 1.80ms                               339ms â€¦  347ms                                    0 ( 0%)        âš¡- 87.6% Â±  0.2%
  peak_rss            405MB Â±    0                                 405MB â€¦  405MB                                    0 ( 0%)        âš¡- 89.2% Â±  0.0%
  cpu_cycles          310M  Â± 1.70M                                307M  â€¦  313M                                     0 ( 0%)        âš¡- 89.2% Â±  0.3%
  instructions        460M  Â±  419                                 460M  â€¦  460M                                     0 ( 0%)        âš¡- 75.9% Â±  0.0%
  cache_references   5.18M  Â±  210K                               4.85M  â€¦ 5.71M                                     0 ( 0%)        âš¡- 96.2% Â±  1.0%
  cache_misses       1.27M  Â± 8.79K                               1.25M  â€¦ 1.28M                                     0 ( 0%)        âš¡- 98.3% Â±  0.2%
  branch_misses       631K  Â± 1.70K                                628K  â€¦  633K                                     0 ( 0%)        âš¡- 84.5% Â±  4.2%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar / -r
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.92s  Â± 4.62ms                              3.92s  â€¦ 3.93s                                     0 ( 0%)        ðŸ’©+ 41.0% Â±  0.7%
  peak_rss           1.84GB Â± 68.9KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles          959M  Â±  892K                                958M  â€¦  960M                                     0 ( 0%)        âš¡- 66.6% Â±  1.0%
  instructions        945M  Â±  112                                 945M  â€¦  945M                                     0 ( 0%)        âš¡- 50.4% Â±  0.1%
  cache_references   5.58M  Â± 96.8K                               5.49M  â€¦ 5.68M                                     0 ( 0%)        âš¡- 95.9% Â±  3.4%
  cache_misses        854K  Â± 1.12K                                853K  â€¦  855K                                     0 ( 0%)        âš¡- 98.8% Â±  0.5%
  branch_misses      2.12M  Â± 59.1K                               2.08M  â€¦ 2.19M                                     0 ( 0%)        âš¡- 47.8% Â± 14.4%
poop "./nix/bin/nix nar ls linux.nar / -Rl" "./lix/bin/nix nar ls linux.nar / -Rl" "./narser/bin/narser ls linux.nar / -Rl" "./narz/bin/narz ls linux.nar / -rl"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.88s  Â± 3.81ms                              2.87s  â€¦ 2.88s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â±  163KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         3.18G  Â± 14.7M                               3.17G  â€¦ 3.20G                                     0 ( 0%)        0%
  instructions       2.60G  Â±  117K                               2.60G  â€¦ 2.60G                                     0 ( 0%)        0%
  cache_references    139M  Â± 2.41M                                137M  â€¦  142M                                     0 ( 0%)        0%
  cache_misses       73.4M  Â±  120K                               73.3M  â€¦ 73.5M                                     0 ( 0%)        0%
  branch_misses      4.98M  Â±  138K                               4.85M  â€¦ 5.13M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.03s  Â± 3.28ms                              3.03s  â€¦ 3.04s                                     0 ( 0%)        ðŸ’©+  5.5% Â±  0.3%
  peak_rss           3.73GB Â±  243KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         3.72G  Â± 26.8M                               3.71G  â€¦ 3.75G                                     0 ( 0%)        ðŸ’©+ 16.9% Â±  1.5%
  instructions       3.89G  Â±  484K                               3.89G  â€¦ 3.89G                                     0 ( 0%)        ðŸ’©+ 49.7% Â±  0.0%
  cache_references    134M  Â± 1.60M                                133M  â€¦  136M                                     0 ( 0%)          -  3.5% Â±  3.3%
  cache_misses       70.9M  Â±  141K                               70.8M  â€¦ 71.1M                                     0 ( 0%)        âš¡-  3.3% Â±  0.4%
  branch_misses      6.31M  Â±  445K                               5.88M  â€¦ 6.77M                                     0 ( 0%)        ðŸ’©+ 26.8% Â± 15.0%
Benchmark 3 (15 runs): ./narser/bin/narser ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           350ms Â± 2.10ms                               348ms â€¦  356ms                                    1 ( 7%)        âš¡- 87.8% Â±  0.1%
  peak_rss            405MB Â± 33.8KB                               404MB â€¦  405MB                                    1 ( 7%)        âš¡- 89.2% Â±  0.0%
  cpu_cycles          320M  Â± 1.87M                                317M  â€¦  323M                                     0 ( 0%)        âš¡- 89.9% Â±  0.2%
  instructions        499M  Â±  253                                 499M  â€¦  499M                                     1 ( 7%)        âš¡- 80.8% Â±  0.0%
  cache_references   5.49M  Â±  216K                               5.11M  â€¦ 5.87M                                     0 ( 0%)        âš¡- 96.0% Â±  0.8%
  cache_misses       1.36M  Â± 15.2K                               1.34M  â€¦ 1.40M                                     0 ( 0%)        âš¡- 98.1% Â±  0.1%
  branch_misses       678K  Â± 1.64K                                676K  â€¦  681K                                     0 ( 0%)        âš¡- 86.4% Â±  1.3%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar / -rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          5.12s  Â± 1.49ms                              5.12s  â€¦ 5.12s                                     0 ( 0%)        ðŸ’©+ 77.9% Â±  0.2%
  peak_rss           1.84GB Â± 4.73KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles         1.14G  Â± 2.93M                               1.13G  â€¦ 1.14G                                     0 ( 0%)        âš¡- 64.3% Â±  0.8%
  instructions       1.11G  Â±  309                                1.11G  â€¦ 1.11G                                     0 ( 0%)        âš¡- 57.2% Â±  0.0%
  cache_references   5.84M  Â±  141K                               5.68M  â€¦ 5.94M                                     0 ( 0%)        âš¡- 95.8% Â±  2.8%
  cache_misses        866K  Â± 3.44K                                862K  â€¦  869K                                     0 ( 0%)        âš¡- 98.8% Â±  0.3%
  branch_misses      2.49M  Â± 60.9K                               2.42M  â€¦ 2.52M                                     0 ( 0%)        âš¡- 50.1% Â±  4.9%
poop "./nix/bin/nix nar ls linux.nar / -l" "./lix/bin/nix nar ls linux.nar / -l" "./narser/bin/narser ls linux.nar / -l" "./narz/bin/narz ls linux.nar / -l"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.56s  Â± 10.3ms                              2.55s  â€¦ 2.58s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â± 38.7KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.49G  Â± 13.6M                               2.48G  â€¦ 2.50G                                     0 ( 0%)        0%
  instructions       1.21G  Â±  213K                               1.21G  â€¦ 1.21G                                     0 ( 0%)        0%
  cache_references    128M  Â± 1.50M                                126M  â€¦  129M                                     0 ( 0%)        0%
  cache_misses       70.9M  Â± 82.1K                               70.8M  â€¦ 71.0M                                     0 ( 0%)        0%
  branch_misses      1.87M  Â±  145K                               1.75M  â€¦ 2.03M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.66s  Â± 2.99ms                              2.66s  â€¦ 2.66s                                     0 ( 0%)        ðŸ’©+  3.8% Â±  0.7%
  peak_rss           3.73GB Â± 72.4KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         2.87G  Â± 1.71M                               2.87G  â€¦ 2.87G                                     0 ( 0%)        ðŸ’©+ 15.4% Â±  0.9%
  instructions       2.16G  Â± 7.15K                               2.16G  â€¦ 2.16G                                     0 ( 0%)        ðŸ’©+ 79.1% Â±  0.0%
  cache_references    132M  Â± 4.26M                                130M  â€¦  137M                                     0 ( 0%)          +  3.5% Â±  5.7%
  cache_misses       70.3M  Â±  112K                               70.1M  â€¦ 70.4M                                     0 ( 0%)          -  0.9% Â±  0.3%
  branch_misses      3.98M  Â±  185K                               3.77M  â€¦ 4.09M                                     0 ( 0%)        ðŸ’©+113.3% Â± 20.1%
Benchmark 3 (16 runs): ./narser/bin/narser ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           318ms Â± 5.03ms                               312ms â€¦  326ms                                    0 ( 0%)        âš¡- 87.6% Â±  0.3%
  peak_rss            405MB Â± 32.8KB                               404MB â€¦  405MB                                    1 ( 6%)        âš¡- 89.2% Â±  0.0%
  cpu_cycles          213M  Â± 1.20M                                212M  â€¦  217M                                     1 ( 6%)        âš¡- 91.4% Â±  0.3%
  instructions        287M  Â±  446                                 287M  â€¦  287M                                     3 (19%)        âš¡- 76.2% Â±  0.0%
  cache_references   3.94M  Â±  277K                               3.54M  â€¦ 4.49M                                     0 ( 0%)        âš¡- 96.9% Â±  0.6%
  cache_misses       74.4K  Â± 7.78K                               64.2K  â€¦ 91.3K                                     1 ( 6%)        âš¡- 99.9% Â±  0.1%
  branch_misses       481K  Â± 3.40K                                477K  â€¦  489K                                     1 ( 6%)        âš¡- 74.3% Â±  3.5%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.73s  Â± 8.93ms                              3.72s  â€¦ 3.74s                                     0 ( 0%)        ðŸ’©+ 45.4% Â±  0.9%
  peak_rss           1.84GB Â± 75.7KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles          871M  Â± 1.18M                                870M  â€¦  873M                                     0 ( 0%)        âš¡- 65.0% Â±  0.9%
  instructions        864M  Â± 80.4                                 864M  â€¦  864M                                     0 ( 0%)        âš¡- 28.5% Â±  0.0%
  cache_references   4.18M  Â± 65.0K                               4.13M  â€¦ 4.25M                                     0 ( 0%)        âš¡- 96.7% Â±  1.9%
  cache_misses        117K  Â±  883                                 116K  â€¦  118K                                     0 ( 0%)        âš¡- 99.8% Â±  0.2%
  branch_misses      1.86M  Â± 30.5K                               1.83M  â€¦ 1.89M                                     0 ( 0%)          -  0.6% Â± 12.7%
poop "./nix/bin/nix nar cat linux.nar /README" "./lix/bin/nix nar cat linux.nar /README" "./narser/bin/narser cat linux.nar /README" "./narz/bin/narz cat linux.nar /README"
Benchmark 1 (3 runs): ./nix/bin/nix nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.55s  Â± 11.2ms                              2.54s  â€¦ 2.56s                                     0 ( 0%)        0%
  peak_rss           3.73GB Â±  114KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)        0%
  cpu_cycles         2.44G  Â± 17.8M                               2.43G  â€¦ 2.46G                                     0 ( 0%)        0%
  instructions       1.14G  Â± 88.8K                               1.14G  â€¦ 1.14G                                     0 ( 0%)        0%
  cache_references    132M  Â± 5.28M                                127M  â€¦  137M                                     0 ( 0%)        0%
  cache_misses       69.8M  Â±  132K                               69.7M  â€¦ 70.0M                                     0 ( 0%)        0%
  branch_misses      1.74M  Â±  361K                               1.51M  â€¦ 2.16M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.68s  Â± 4.01ms                              2.68s  â€¦ 2.68s                                     0 ( 0%)        ðŸ’©+  5.3% Â±  0.7%
  peak_rss           3.73GB Â±  132KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          +  0.2% Â±  0.0%
  cpu_cycles         2.92G  Â± 32.1M                               2.90G  â€¦ 2.96G                                     0 ( 0%)        ðŸ’©+ 19.6% Â±  2.4%
  instructions       2.17G  Â± 6.21K                               2.17G  â€¦ 2.17G                                     0 ( 0%)        ðŸ’©+ 91.3% Â±  0.0%
  cache_references    129M  Â± 1.41M                                127M  â€¦  130M                                     0 ( 0%)          -  2.3% Â±  6.7%
  cache_misses       70.3M  Â±  143K                               70.1M  â€¦ 70.4M                                     0 ( 0%)          +  0.6% Â±  0.4%
  branch_misses      4.48M  Â±  801K                               3.99M  â€¦ 5.41M                                     0 ( 0%)        ðŸ’©+157.5% Â± 80.9%
Benchmark 3 (4 runs): ./narser/bin/narser cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.39s  Â± 11.5ms                              1.38s  â€¦ 1.40s                                     1 (25%)        âš¡- 45.4% Â±  0.9%
  peak_rss           2.23GB Â±    0                                2.23GB â€¦ 2.23GB                                    0 ( 0%)        âš¡- 40.3% Â±  0.0%
  cpu_cycles          499M  Â±  999K                                498M  â€¦  500M                                     0 ( 0%)        âš¡- 79.6% Â±  0.9%
  instructions        534M  Â± 84.1                                 534M  â€¦  534M                                     0 ( 0%)        âš¡- 52.9% Â±  0.0%
  cache_references   19.4M  Â±  586K                               18.9M  â€¦ 20.2M                                     0 ( 0%)        âš¡- 85.3% Â±  5.0%
  cache_misses       2.18M  Â± 18.4K                               2.16M  â€¦ 2.20M                                     0 ( 0%)        âš¡- 96.9% Â±  0.2%
  branch_misses       953K  Â± 2.60K                                950K  â€¦  956K                                     0 ( 0%)        âš¡- 45.3% Â± 25.7%
Benchmark 4 (3 runs): ./narz/bin/narz cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.75s  Â± 19.9ms                              3.72s  â€¦ 3.76s                                     0 ( 0%)        ðŸ’©+ 47.1% Â±  1.4%
  peak_rss           1.84GB Â±  151KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 50.7% Â±  0.0%
  cpu_cycles          874M  Â±  577K                                874M  â€¦  875M                                     0 ( 0%)        âš¡- 64.2% Â±  1.2%
  instructions        864M  Â± 11.4K                                864M  â€¦  864M                                     0 ( 0%)        âš¡- 23.9% Â±  0.0%
  cache_references   4.10M  Â±  371K                               3.86M  â€¦ 4.52M                                     0 ( 0%)        âš¡- 96.9% Â±  6.4%
  cache_misses        124K  Â±  980                                 124K  â€¦  125K                                     0 ( 0%)        âš¡- 99.8% Â±  0.3%
  branch_misses      1.90M  Â± 30.1K                               1.88M  â€¦ 1.94M                                     0 ( 0%)          +  9.1% Â± 33.3%

./nix/bin/nix-store --restore out < linux.nar
cmp <(./nix/bin/nix nar pack out) linux.nar
rm -rf out

./lix/bin/nix-store --restore out < linux.nar
cmp <(./nix/bin/nix nar pack out) linux.nar
rm -rf out

./narser/bin/narser unpack linux.nar out
cmp <(./nix/bin/nix nar pack out) linux.nar || exit 1
rm -rf out

rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.597s
user	0m0.352s
sys	0m1.234s
rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.604s
user	0m0.341s
sys	0m1.256s
rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.600s
user	0m0.337s
sys	0m1.257s

rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.782s
user	0m0.517s
sys	0m1.252s
rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.789s
user	0m0.477s
sys	0m1.305s
rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.777s
user	0m0.490s
sys	0m1.280s

rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.489s
user	0m0.281s
sys	0m1.201s
rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.487s
user	0m0.286s
sys	0m1.194s
rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.498s
user	0m0.268s
sys	0m1.219s
