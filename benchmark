
echo $1
/tmp/clevor/tests

mkdir $1 || exit 1
cd $1

nix build git+https://git.lix.systems/lix-project/lix?rev=992c3ae981e75c902f72e8a04b44e902e9501642 -o lix >& /dev/null || exit 1
nix build github:NixOS/nix/89141f1d675768cf98c757c539108ce663adda01 -o nix >& /dev/null || exit 1
nix build git+https://git.sr.ht/~watersucks/narz?rev=f790364c93142affa3cc699365545d6a11916a76 -o narz >& /dev/null || exit 1
nix build github:myclevorname/narser/5b5239168adfda18d6ec60afeed5cf30c965f58a -o narser >& /dev/null || exit 1
nix build gitlab:abstract-binary/nix-nar-rs/c8d9250b9be837abafa0046cb9c2a852b846da6a -o nix-nar >& /dev/null || exit 1

git clone https://github.com/torvalds/linux --depth=1 -q
cd linux
git log | head
commit 4ff71af020ae59ae2d83b174646fc2ad9fcd4dc4
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu Sep 25 08:23:52 2025 -0700

    Merge tag 'net-6.17-rc8' of git://git.kernel.org/pub/scm/linux/kernel/git/netdev/net
    
    Pull networking fixes from Paolo Abeni:
     "Including fixes from Bluetooth, IPsec and CAN.
    
      No known regressions at this point.
cd ..

nix nar pack linux > linux.nar

cmp <(./nix/bin/nix nar pack linux) <(./lix/bin/nix nar dump-path linux)
cmp <(./nix/bin/nix nar pack linux) <(./narser/bin/narser pack linux) || exit 1
cmp <(./nix/bin/nix nar pack linux) <(./nix-nar/bin/nix-nar dump-path linux)

cmp <(./nix/bin/nix nar cat linux.nar /README) <(./lix/bin/nix nar cat linux.nar /README)
cmp <(./nix/bin/nix nar cat linux.nar /README) <(./narser/bin/narser cat linux.nar /README) || exit 1
cmp <(./nix/bin/nix nar cat linux.nar /README) <(./narz/bin/narz cat linux.nar /README)
cmp <(./nix/bin/nix nar cat linux.nar /README) <(./nix-nar/bin/nix-nar cat linux.nar /README)

cmp <(./nix/bin/nix nar ls linux.nar /) <(./lix/bin/nix nar ls linux.nar /)
cmp <(./nix/bin/nix nar ls linux.nar /) <(./narser/bin/narser ls linux.nar /) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / 2> /dev/null) <(./narz/bin/narz ls linux.nar / 2> /dev/null)
cmp: EOF on â€˜/dev/fd/62â€™ which is empty
cmp <(./nix/bin/nix nar ls linux.nar /) <(./nix-nar/bin/nix-nar ls linux.nar /)

cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./lix/bin/nix nar ls linux.nar / -l)
cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./narser/bin/narser ls linux.nar / -l) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -l 2> /dev/null) <(./narz/bin/narz ls linux.nar / -l 2> /dev/null)
cmp: EOF on â€˜/dev/fd/62â€™ which is empty
cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./nix-nar/bin/nix-nar ls linux.nar / -l)

cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./lix/bin/nix nar ls linux.nar / -lR)
cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./narser/bin/narser ls linux.nar / -lR) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -lR 2> /dev/null) <(./narz/bin/narz ls linux.nar / -lr 2> /dev/null)
cmp: EOF on â€˜/dev/fd/62â€™ which is empty
cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./nix-nar/bin/nix-nar ls linux.nar / -lR)

cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./lix/bin/nix nar ls linux.nar / -R)
cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./narser/bin/narser ls linux.nar / -R) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -R 2> /dev/null) <(./narz/bin/narz ls linux.nar / -r 2> /dev/null)
cmp: EOF on â€˜/dev/fd/62â€™ which is empty
cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./nix-nar/bin/nix-nar ls linux.nar / -R)


poop "./nix/bin/nix nar pack linux" "./lix/bin/nix nar dump-path linux" "./narser/bin/narser pack linux" "./nix-nar/bin/nix-nar dump-path linux"
Benchmark 1 (3 runs): ./nix/bin/nix nar pack linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.96s  Â± 73.2ms                              1.88s  â€¦ 2.01s                                     0 ( 0%)        0%
  peak_rss           40.4MB Â± 90.9KB                              40.3MB â€¦ 40.5MB                                    0 ( 0%)        0%
  cpu_cycles         3.70G  Â±  235M                               3.43G  â€¦ 3.84G                                     0 ( 0%)        0%
  instructions       7.40G  Â±  133K                               7.40G  â€¦ 7.40G                                     0 ( 0%)        0%
  cache_references   56.2M  Â± 1.66M                               55.0M  â€¦ 58.1M                                     0 ( 0%)        0%
  cache_misses       4.45M  Â± 64.0K                               4.38M  â€¦ 4.50M                                     0 ( 0%)        0%
  branch_misses      14.9M  Â± 5.54M                               8.54M  â€¦ 18.3M                                     0 ( 0%)        0%
Benchmark 2 (5 runs): ./lix/bin/nix nar dump-path linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.18s  Â± 74.4ms                              1.13s  â€¦ 1.31s                                     0 ( 0%)        âš¡- 39.9% Â±  6.7%
  peak_rss           33.4MB Â± 72.3KB                              33.3MB â€¦ 33.5MB                                    1 (20%)        âš¡- 17.4% Â±  0.3%
  cpu_cycles         1.41G  Â±  227M                               1.27G  â€¦ 1.80G                                     0 ( 0%)        âš¡- 62.0% Â± 11.1%
  instructions       1.81G  Â± 9.89K                               1.81G  â€¦ 1.81G                                     0 ( 0%)        âš¡- 75.5% Â±  0.0%
  cache_references   82.7M  Â± 2.48M                               80.7M  â€¦ 86.8M                                     0 ( 0%)        ðŸ’©+ 47.2% Â±  7.1%
  cache_misses        772K  Â± 77.9K                                721K  â€¦  907K                                     0 ( 0%)        âš¡- 82.7% Â±  3.0%
  branch_misses      6.36M  Â± 5.84M                               3.15M  â€¦ 16.6M                                     0 ( 0%)          - 57.4% Â± 68.7%
Benchmark 3 (7 runs): ./narser/bin/narser pack linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           724ms Â± 1.11ms                               722ms â€¦  725ms                                    0 ( 0%)        âš¡- 63.1% Â±  3.0%
  peak_rss           1.58MB Â± 49.5KB                              1.47MB â€¦ 1.60MB                                    1 (14%)        âš¡- 96.1% Â±  0.2%
  cpu_cycles          186M  Â±  837K                                185M  â€¦  187M                                     0 ( 0%)        âš¡- 95.0% Â±  5.1%
  instructions        327M  Â± 5.57K                                327M  â€¦  327M                                     0 ( 0%)        âš¡- 95.6% Â±  0.0%
  cache_references   5.90M  Â±  189K                               5.66M  â€¦ 6.12M                                     0 ( 0%)        âš¡- 89.5% Â±  2.4%
  cache_misses        170K  Â± 7.84K                                160K  â€¦  181K                                     0 ( 0%)        âš¡- 96.2% Â±  1.2%
  branch_misses       727K  Â± 3.21K                                723K  â€¦  733K                                     0 ( 0%)        âš¡- 95.1% Â± 29.5%
Benchmark 4 (4 runs): ./nix-nar/bin/nix-nar dump-path linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.54s  Â± 4.06ms                              1.53s  â€¦ 1.54s                                     0 ( 0%)        âš¡- 21.7% Â±  4.6%
  peak_rss           2.87MB Â± 98.9KB                              2.75MB â€¦ 2.97MB                                    0 ( 0%)        âš¡- 92.9% Â±  0.5%
  cpu_cycles          538M  Â± 5.03M                                534M  â€¦  545M                                     0 ( 0%)        âš¡- 85.5% Â±  7.9%
  instructions        829M  Â±  111K                                829M  â€¦  829M                                     0 ( 0%)        âš¡- 88.8% Â±  0.0%
  cache_references   10.0M  Â±  375K                               9.72M  â€¦ 10.6M                                     0 ( 0%)        âš¡- 82.2% Â±  3.8%
  cache_misses        377K  Â± 24.7K                                355K  â€¦  405K                                     0 ( 0%)        âš¡- 91.5% Â±  2.0%
  branch_misses      2.68M  Â± 94.4K                               2.58M  â€¦ 2.80M                                     0 ( 0%)        âš¡- 82.1% Â± 46.1%
poop "./nix/bin/nix nar ls linux.nar /" "./lix/bin/nix nar ls linux.nar /" "./narser/bin/narser ls linux.nar /" "./nix-nar/bin/nix-nar ls linux.nar /" "./narz/bin/narz ls linux.nar /"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.47s  Â± 8.98ms                              2.47s  â€¦ 2.48s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â±  160KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.50G  Â± 11.2M                               2.48G  â€¦ 2.51G                                     0 ( 0%)        0%
  instructions       1.21G  Â±  168K                               1.21G  â€¦ 1.21G                                     0 ( 0%)        0%
  cache_references    127M  Â±  922K                                126M  â€¦  128M                                     0 ( 0%)        0%
  cache_misses       71.1M  Â±  118K                               71.0M  â€¦ 71.2M                                     0 ( 0%)        0%
  branch_misses      2.14M  Â±  336K                               1.82M  â€¦ 2.49M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.58s  Â± 5.61ms                              2.58s  â€¦ 2.59s                                     0 ( 0%)        ðŸ’©+  4.2% Â±  0.7%
  peak_rss           3.73GB Â± 49.8KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         2.89G  Â± 12.3M                               2.88G  â€¦ 2.90G                                     0 ( 0%)        ðŸ’©+ 15.5% Â±  1.1%
  instructions       2.16G  Â± 10.5K                               2.16G  â€¦ 2.16G                                     0 ( 0%)        ðŸ’©+ 79.0% Â±  0.0%
  cache_references    128M  Â± 1.31M                                127M  â€¦  130M                                     0 ( 0%)          +  1.0% Â±  2.0%
  cache_misses       70.3M  Â±  171K                               70.1M  â€¦ 70.4M                                     0 ( 0%)          -  1.1% Â±  0.5%
  branch_misses      4.09M  Â±  335K                               3.84M  â€¦ 4.47M                                     0 ( 0%)        ðŸ’©+ 91.3% Â± 35.5%
Benchmark 3 (46 runs): ./narser/bin/narser ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           109ms Â± 1.69ms                               108ms â€¦  114ms                                    8 (17%)        âš¡- 95.6% Â±  0.1%
  peak_rss           33.4MB Â± 19.3KB                              33.3MB â€¦ 33.5MB                                    1 ( 2%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles         78.5M  Â±  601K                               78.0M  â€¦ 80.7M                                     4 ( 9%)        âš¡- 96.9% Â±  0.1%
  instructions        171M  Â±  232                                 171M  â€¦  171M                                     2 ( 4%)        âš¡- 85.8% Â±  0.0%
  cache_references    978K  Â± 27.9K                                917K  â€¦ 1.04M                                     0 ( 0%)        âš¡- 99.2% Â±  0.2%
  cache_misses       14.8K  Â± 1.82K                               13.1K  â€¦ 22.4K                                     6 (13%)        âš¡-100.0% Â±  0.0%
  branch_misses       340K  Â± 4.21K                                337K  â€¦  360K                                     6 (13%)        âš¡- 84.1% Â±  3.9%
Benchmark 4 (10 runs): ./nix-nar/bin/nix-nar ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           520ms Â± 2.93ms                               515ms â€¦  525ms                                    0 ( 0%)        âš¡- 79.0% Â±  0.3%
  peak_rss           2.40MB Â± 68.4KB                              2.29MB â€¦ 2.50MB                                    0 ( 0%)        âš¡- 99.9% Â±  0.0%
  cpu_cycles          937M  Â± 8.46M                                927M  â€¦  956M                                     0 ( 0%)        âš¡- 62.5% Â±  0.5%
  instructions       1.50G  Â± 63.9K                               1.50G  â€¦ 1.50G                                     0 ( 0%)        ðŸ’©+ 24.4% Â±  0.0%
  cache_references   7.49M  Â± 1.54M                               4.54M  â€¦ 9.19M                                     0 ( 0%)        âš¡- 94.1% Â±  1.6%
  cache_misses       59.6K  Â± 8.87K                               46.9K  â€¦ 73.1K                                     0 ( 0%)        âš¡- 99.9% Â±  0.1%
  branch_misses      1.13M  Â±  130K                               1000K  â€¦ 1.35M                                     0 ( 0%)        âš¡- 47.1% Â± 12.6%

error: Benchmark 5 command './narz/bin/narz ls linux.nar /' failed with exit code 1:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ stderr â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
poop "./nix/bin/nix nar ls linux.nar / -R" "./lix/bin/nix nar ls linux.nar / -R" "./narser/bin/narser ls linux.nar / -R" "./nix-nar/bin/nix-nar ls linux.nar / -R" "./narz/bin/narz ls linux.nar / -r"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.70s  Â± 11.3ms                              2.69s  â€¦ 2.71s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â± 47.2KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.89G  Â± 29.9M                               2.87G  â€¦ 2.92G                                     0 ( 0%)        0%
  instructions       1.91G  Â±  110K                               1.91G  â€¦ 1.91G                                     0 ( 0%)        0%
  cache_references    138M  Â± 3.44M                                136M  â€¦  142M                                     0 ( 0%)        0%
  cache_misses       73.8M  Â± 64.1K                               73.7M  â€¦ 73.9M                                     0 ( 0%)        0%
  branch_misses      4.54M  Â±  803K                               4.00M  â€¦ 5.47M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.82s  Â± 3.20ms                              2.82s  â€¦ 2.82s                                     0 ( 0%)        ðŸ’©+  4.5% Â±  0.7%
  peak_rss           3.73GB Â±  139KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         3.33G  Â± 4.06M                               3.33G  â€¦ 3.34G                                     0 ( 0%)        ðŸ’©+ 15.4% Â±  1.7%
  instructions       3.01G  Â±  492K                               3.01G  â€¦ 3.01G                                     0 ( 0%)        ðŸ’©+ 57.7% Â±  0.0%
  cache_references    131M  Â± 2.85M                                129M  â€¦  134M                                     0 ( 0%)          -  5.3% Â±  5.2%
  cache_misses       71.2M  Â±  320K                               70.8M  â€¦ 71.4M                                     0 ( 0%)        âš¡-  3.5% Â±  0.7%
  branch_misses      5.41M  Â± 45.8K                               5.38M  â€¦ 5.46M                                     0 ( 0%)          + 19.0% Â± 28.4%
Benchmark 3 (39 runs): ./narser/bin/narser ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           131ms Â± 1.72ms                               129ms â€¦  137ms                                    3 ( 8%)        âš¡- 95.1% Â±  0.1%
  peak_rss           33.5MB Â±    0                                33.5MB â€¦ 33.5MB                                    0 ( 0%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles          154M  Â± 4.88M                                150M  â€¦  171M                                     4 (10%)        âš¡- 94.7% Â±  0.3%
  instructions        344M  Â±  171                                 344M  â€¦  344M                                     0 ( 0%)        âš¡- 82.0% Â±  0.0%
  cache_references   2.06M  Â± 44.6K                               1.91M  â€¦ 2.11M                                     3 ( 8%)        âš¡- 98.5% Â±  0.7%
  cache_misses        886K  Â± 34.8K                                766K  â€¦  927K                                     5 (13%)        âš¡- 98.8% Â±  0.1%
  branch_misses       491K  Â± 5.49K                                487K  â€¦  513K                                     5 (13%)        âš¡- 89.2% Â±  4.8%
Benchmark 4 (8 runs): ./nix-nar/bin/nix-nar ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           638ms Â± 4.20ms                               633ms â€¦  646ms                                    0 ( 0%)        âš¡- 76.3% Â±  0.4%
  peak_rss           13.9MB Â± 88.2KB                              13.8MB â€¦ 14.0MB                                    0 ( 0%)        âš¡- 99.6% Â±  0.0%
  cpu_cycles         1.13G  Â± 8.79M                               1.12G  â€¦ 1.14G                                     0 ( 0%)        âš¡- 60.9% Â±  0.9%
  instructions       1.95G  Â± 73.6K                               1.95G  â€¦ 1.95G                                     0 ( 0%)        ðŸ’©+  2.2% Â±  0.0%
  cache_references   13.2M  Â± 2.55M                               9.29M  â€¦ 16.7M                                     2 (25%)        âš¡- 90.5% Â±  3.1%
  cache_misses        181K  Â± 13.9K                                164K  â€¦  200K                                     0 ( 0%)        âš¡- 99.8% Â±  0.1%
  branch_misses      1.70M  Â±  200K                               1.52M  â€¦ 2.07M                                     0 ( 0%)        âš¡- 62.7% Â± 14.1%

error: Benchmark 5 command './narz/bin/narz ls linux.nar / -r' failed with exit code 1:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ stderr â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
error(gpa): memory address 0x7f7195e80000 leaked: 

error(gpa): memory address 0x7f7195e80002 leaked: 

error(gpa): memory address 0x7f7195f00000 leaked: 

error(gpa): memory address 0x7f7195f00004 leaked: 

error(gpa): memory address 0x7f7195f00008 leaked: 

error(gpa): memory address 0x7f7195f0000c leaked: 

error(gpa): memory address 0x7f7195f00010 leaked: 

error(gpa): memory address 0x7f7195f00014 leaked: 

error(gpa): memory address 0x7f7195f00018 leaked: 

error(gpa): memory address 0x7f7195f0001c leaked: 

error(gpa): memory address 0x7f7195f00020 leaked: 

error(gpa): memory address 0x7f7195ee0000 leaked: 

error(gpa): memory address 0x7f7195ee0008 leaked: 

error(gpa): memory address 0x7f7195ee0010 leaked: 

error(gpa): memory address 0x7f7195ee0018 leaked: 

error(gpa): memory address 0x7f7195ee0020 leaked: 

error(gpa): memory address 0x7f7195ee0028 leaked: 

error(gpa): memory address 0x7f7195ee0030 leaked: 

error(gpa): memory address 0x7f7195ee0038 leaked: 

error(gpa): memory address 0x7f7195ee0040 leaked: 

error(gpa): memory address 0x7f7195ee0048 leaked: 

error(gpa): memory address 0x7f7195ee0050 leaked: 

error(gpa): memory address 0x7f7195ee0058 leaked: 

error(gpa): memory address 0x7f7195ee0060 leaked: 

error(gpa): memory address 0x7f7195ee0068 leaked: 

error(gpa): memory address 0x7f7195ee0070 leaked: 

error(gpa): memory address 0x7f7195ee0078 leaked: 

error(gpa): memory address 0x7f7195ee0080 leaked: 

error(gpa): memory address 0x7f7195ee0088 leaked: 

error(gpa): memory address 0x7f7195ee0090 leaked: 

error(gpa): memory address 0x7f7195ee0098 leaked: 

error(gpa): memory address 0x7f7195e60000 leaked: 

error(gpa): memory address 0x7f7195e60010 leaked: 

error(gpa): memory address 0x7f7195e60020 leaked: 

error(gpa): memory address 0x7f7195e60030 leaked: 

error(gpa): memory address 0x7f7195e60040 leaked: 

error(gpa): memory address 0x7f7195e60050 leaked: 

error(gpa): memory address 0x7f7195e60060 leaked: 

error(gpa): memory address 0x7f7195e60070 leaked: 

error(gpa): memory address 0x7f7195e60080 leaked: 

error(gpa): memory address 0x7f7195e40000 leaked: 


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
poop "./nix/bin/nix nar ls linux.nar / -Rl" "./lix/bin/nix nar ls linux.nar / -Rl" "./narser/bin/narser ls linux.nar / -Rl" "./nix-nar/bin/nix-nar ls linux.nar / -Rl" "./narz/bin/narz ls linux.nar / -rl"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.79s  Â± 19.4ms                              2.78s  â€¦ 2.81s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â± 26.7KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         3.19G  Â± 82.4M                               3.15G  â€¦ 3.29G                                     0 ( 0%)        0%
  instructions       2.60G  Â± 1.05M                               2.60G  â€¦ 2.60G                                     0 ( 0%)        0%
  cache_references    141M  Â± 4.92M                                138M  â€¦  147M                                     0 ( 0%)        0%
  cache_misses       73.7M  Â± 97.6K                               73.6M  â€¦ 73.8M                                     0 ( 0%)        0%
  branch_misses      5.36M  Â± 1.68M                               4.34M  â€¦ 7.30M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.98s  Â± 61.7ms                              2.94s  â€¦ 3.05s                                     0 ( 0%)        ðŸ’©+  6.7% Â±  3.7%
  peak_rss           3.73GB Â± 85.2KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         3.80G  Â± 91.5M                               3.74G  â€¦ 3.91G                                     0 ( 0%)        ðŸ’©+ 19.1% Â±  6.2%
  instructions       3.89G  Â±  109K                               3.89G  â€¦ 3.89G                                     0 ( 0%)        ðŸ’©+ 49.7% Â±  0.1%
  cache_references    132M  Â± 2.15M                                130M  â€¦  135M                                     0 ( 0%)          -  6.4% Â±  6.1%
  cache_misses       71.2M  Â±  193K                               71.1M  â€¦ 71.4M                                     0 ( 0%)        âš¡-  3.3% Â±  0.5%
  branch_misses      7.54M  Â± 1.87M                               6.12M  â€¦ 9.66M                                     0 ( 0%)          + 40.7% Â± 75.2%
Benchmark 3 (38 runs): ./narser/bin/narser ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           134ms Â±  833us                               133ms â€¦  137ms                                    4 (11%)        âš¡- 95.2% Â±  0.2%
  peak_rss           33.4MB Â± 21.3KB                              33.3MB â€¦ 33.5MB                                    1 ( 3%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles          165M  Â± 2.19M                                163M  â€¦  176M                                     9 (24%)        âš¡- 94.8% Â±  0.7%
  instructions        383M  Â±  180                                 383M  â€¦  383M                                     0 ( 0%)        âš¡- 85.3% Â±  0.0%
  cache_references   2.20M  Â± 26.9K                               2.09M  â€¦ 2.26M                                     2 ( 5%)        âš¡- 98.4% Â±  1.0%
  cache_misses        918K  Â± 19.4K                                832K  â€¦  982K                                     3 ( 8%)        âš¡- 98.8% Â±  0.0%
  branch_misses       540K  Â± 3.51K                                537K  â€¦  553K                                     6 (16%)        âš¡- 89.9% Â±  8.7%
Benchmark 4 (8 runs): ./nix-nar/bin/nix-nar ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           665ms Â±  680us                               664ms â€¦  666ms                                    0 ( 0%)        âš¡- 76.2% Â±  0.5%
  peak_rss           13.9MB Â± 44.5KB                              13.9MB â€¦ 14.0MB                                    0 ( 0%)        âš¡- 99.6% Â±  0.0%
  cpu_cycles         1.22G  Â± 4.15M                               1.22G  â€¦ 1.23G                                     0 ( 0%)        âš¡- 61.7% Â±  1.9%
  instructions       2.21G  Â± 78.9K                               2.21G  â€¦ 2.21G                                     0 ( 0%)        âš¡- 14.9% Â±  0.0%
  cache_references   12.6M  Â± 2.32M                               11.0M  â€¦ 17.9M                                     1 (13%)        âš¡- 91.1% Â±  3.4%
  cache_misses        297K  Â± 10.3K                                280K  â€¦  314K                                     0 ( 0%)        âš¡- 99.6% Â±  0.1%
  branch_misses      1.76M  Â± 87.4K                               1.65M  â€¦ 1.93M                                     3 (38%)        âš¡- 67.1% Â± 22.7%

error: Benchmark 5 command './narz/bin/narz ls linux.nar / -rl' failed with exit code 1:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ stderr â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
error(gpa): memory address 0x7f11fba40000 leaked: 

error(gpa): memory address 0x7f11fba40002 leaked: 

error(gpa): memory address 0x7f11fbac0000 leaked: 

error(gpa): memory address 0x7f11fbac0004 leaked: 

error(gpa): memory address 0x7f11fbac0008 leaked: 

error(gpa): memory address 0x7f11fbac000c leaked: 

error(gpa): memory address 0x7f11fbac0010 leaked: 

error(gpa): memory address 0x7f11fbac0014 leaked: 

error(gpa): memory address 0x7f11fbac0018 leaked: 

error(gpa): memory address 0x7f11fbac001c leaked: 

error(gpa): memory address 0x7f11fbac0020 leaked: 

error(gpa): memory address 0x7f11fbaa0000 leaked: 

error(gpa): memory address 0x7f11fbaa0008 leaked: 

error(gpa): memory address 0x7f11fbaa0010 leaked: 

error(gpa): memory address 0x7f11fbaa0018 leaked: 

error(gpa): memory address 0x7f11fbaa0020 leaked: 

error(gpa): memory address 0x7f11fbaa0028 leaked: 

error(gpa): memory address 0x7f11fbaa0030 leaked: 

error(gpa): memory address 0x7f11fbaa0038 leaked: 

error(gpa): memory address 0x7f11fbaa0040 leaked: 

error(gpa): memory address 0x7f11fbaa0048 leaked: 

error(gpa): memory address 0x7f11fbaa0050 leaked: 

error(gpa): memory address 0x7f11fbaa0058 leaked: 

error(gpa): memory address 0x7f11fbaa0060 leaked: 

error(gpa): memory address 0x7f11fbaa0068 leaked: 

error(gpa): memory address 0x7f11fbaa0070 leaked: 

error(gpa): memory address 0x7f11fbaa0078 leaked: 

error(gpa): memory address 0x7f11fbaa0080 leaked: 

error(gpa): memory address 0x7f11fbaa0088 leaked: 

error(gpa): memory address 0x7f11fbaa0090 leaked: 

error(gpa): memory address 0x7f11fbaa0098 leaked: 

error(gpa): memory address 0x7f11fba20000 leaked: 

error(gpa): memory address 0x7f11fba20010 leaked: 

error(gpa): memory address 0x7f11fba20020 leaked: 

error(gpa): memory address 0x7f11fba20030 leaked: 

error(gpa): memory address 0x7f11fba20040 leaked: 

error(gpa): memory address 0x7f11fba20050 leaked: 

error(gpa): memory address 0x7f11fba20060 leaked: 

error(gpa): memory address 0x7f11fba20070 leaked: 

error(gpa): memory address 0x7f11fba20080 leaked: 

error(gpa): memory address 0x7f11fba00000 leaked: 


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
poop "./nix/bin/nix nar ls linux.nar / -l" "./lix/bin/nix nar ls linux.nar / -l" "./narser/bin/narser ls linux.nar / -l" "./nix-nar/bin/nix-nar ls linux.nar / -l" "./narz/bin/narz ls linux.nar / -l"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.47s  Â± 10.2ms                              2.46s  â€¦ 2.48s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â±  135KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.49G  Â± 10.4M                               2.48G  â€¦ 2.50G                                     0 ( 0%)        0%
  instructions       1.21G  Â±  233K                               1.21G  â€¦ 1.21G                                     0 ( 0%)        0%
  cache_references    128M  Â± 3.32M                                126M  â€¦  132M                                     0 ( 0%)        0%
  cache_misses       71.1M  Â±  105K                               71.0M  â€¦ 71.2M                                     0 ( 0%)        0%
  branch_misses      1.96M  Â±  298K                               1.76M  â€¦ 2.30M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.58s  Â± 2.77ms                              2.58s  â€¦ 2.58s                                     0 ( 0%)        ðŸ’©+  4.2% Â±  0.7%
  peak_rss           3.73GB Â± 94.5KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         2.89G  Â± 11.7M                               2.89G  â€¦ 2.91G                                     0 ( 0%)        ðŸ’©+ 16.0% Â±  1.0%
  instructions       2.16G  Â± 6.82K                               2.16G  â€¦ 2.16G                                     0 ( 0%)        ðŸ’©+ 79.0% Â±  0.0%
  cache_references    131M  Â± 4.25M                                128M  â€¦  135M                                     0 ( 0%)          +  1.8% Â±  6.7%
  cache_misses       70.5M  Â± 40.2K                               70.4M  â€¦ 70.5M                                     0 ( 0%)          -  0.9% Â±  0.3%
  branch_misses      4.17M  Â±  375K                               3.85M  â€¦ 4.58M                                     0 ( 0%)        ðŸ’©+112.6% Â± 39.2%
Benchmark 3 (46 runs): ./narser/bin/narser ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           110ms Â± 3.17ms                               108ms â€¦  124ms                                    7 (15%)        âš¡- 95.5% Â±  0.2%
  peak_rss           33.5MB Â±    0                                33.5MB â€¦ 33.5MB                                    0 ( 0%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles         79.3M  Â± 3.48M                               78.1M  â€¦  100M                                     7 (15%)        âš¡- 96.8% Â±  0.2%
  instructions        171M  Â±  196                                 171M  â€¦  171M                                     2 ( 4%)        âš¡- 85.8% Â±  0.0%
  cache_references    972K  Â± 23.0K                                940K  â€¦ 1.04M                                     1 ( 2%)        âš¡- 99.2% Â±  0.6%
  cache_misses       15.5K  Â± 2.49K                               13.0K  â€¦ 27.2K                                     2 ( 4%)        âš¡-100.0% Â±  0.0%
  branch_misses       347K  Â± 32.8K                                337K  â€¦  556K                                     7 (15%)        âš¡- 82.3% Â±  4.3%
Benchmark 4 (10 runs): ./nix-nar/bin/nix-nar ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           520ms Â± 2.70ms                               516ms â€¦  523ms                                    0 ( 0%)        âš¡- 79.0% Â±  0.3%
  peak_rss           2.42MB Â± 70.6KB                              2.30MB â€¦ 2.51MB                                    0 ( 0%)        âš¡- 99.9% Â±  0.0%
  cpu_cycles          938M  Â± 6.50M                                929M  â€¦  947M                                     0 ( 0%)        âš¡- 62.4% Â±  0.4%
  instructions       1.50G  Â± 84.7K                               1.50G  â€¦ 1.50G                                     0 ( 0%)        ðŸ’©+ 24.4% Â±  0.0%
  cache_references   8.68M  Â± 2.32M                               6.13M  â€¦ 12.3M                                     0 ( 0%)        âš¡- 93.2% Â±  2.9%
  cache_misses       60.1K  Â± 10.4K                               48.3K  â€¦ 77.1K                                     0 ( 0%)        âš¡- 99.9% Â±  0.1%
  branch_misses      1.18M  Â±  148K                                978K  â€¦ 1.34M                                     0 ( 0%)        âš¡- 40.0% Â± 13.6%

error: Benchmark 5 command './narz/bin/narz ls linux.nar / -l' failed with exit code 1:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ stderr â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
poop "./nix/bin/nix nar cat linux.nar /README" "./lix/bin/nix nar cat linux.nar /README" "./narser/bin/narser cat linux.nar /README" "./narser/bin/narser cat linux.nar /README -L" "./nix-nar/bin/nix-nar cat linux.nar /README" "./narz/bin/narz cat linux.nar /README"
Benchmark 1 (3 runs): ./nix/bin/nix nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.46s  Â± 10.4ms                              2.46s  â€¦ 2.48s                                     0 ( 0%)        0%
  peak_rss           3.73GB Â±  140KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)        0%
  cpu_cycles         2.45G  Â± 19.5M                               2.44G  â€¦ 2.47G                                     0 ( 0%)        0%
  instructions       1.14G  Â±  297K                               1.14G  â€¦ 1.14G                                     0 ( 0%)        0%
  cache_references    129M  Â± 4.64M                                126M  â€¦  134M                                     0 ( 0%)        0%
  cache_misses       69.9M  Â±  166K                               69.7M  â€¦ 70.1M                                     0 ( 0%)        0%
  branch_misses      2.11M  Â±  524K                               1.60M  â€¦ 2.65M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.59s  Â± 4.76ms                              2.59s  â€¦ 2.59s                                     0 ( 0%)        ðŸ’©+  5.1% Â±  0.7%
  peak_rss           3.74GB Â± 53.2KB                              3.73GB â€¦ 3.74GB                                    0 ( 0%)          +  0.2% Â±  0.0%
  cpu_cycles         2.90G  Â± 13.2M                               2.88G  â€¦ 2.91G                                     0 ( 0%)        ðŸ’©+ 18.3% Â±  1.5%
  instructions       2.17G  Â± 7.62K                               2.17G  â€¦ 2.17G                                     0 ( 0%)        ðŸ’©+ 91.1% Â±  0.0%
  cache_references    128M  Â±  860K                                127M  â€¦  129M                                     0 ( 0%)          -  0.9% Â±  5.9%
  cache_misses       70.4M  Â± 87.2K                               70.3M  â€¦ 70.5M                                     0 ( 0%)          +  0.8% Â±  0.4%
  branch_misses      4.28M  Â±  430K                               3.78M  â€¦ 4.55M                                     0 ( 0%)        ðŸ’©+102.6% Â± 51.5%
Benchmark 3 (483 runs): ./narser/bin/narser cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          10.3ms Â±  352us                              10.2ms â€¦ 13.8ms                                   41 ( 8%)        âš¡- 99.6% Â±  0.0%
  peak_rss           1.05MB Â±    0                                1.05MB â€¦ 1.05MB                                    0 ( 0%)        âš¡-100.0% Â±  0.0%
  cpu_cycles         8.37M  Â±  374K                               8.22M  â€¦ 11.5M                                    62 (13%)        âš¡- 99.7% Â±  0.1%
  instructions       19.3M  Â± 3.23                                19.3M  â€¦ 19.3M                                    29 ( 6%)        âš¡- 98.3% Â±  0.0%
  cache_references   19.8K  Â± 1.74K                               17.0K  â€¦ 37.0K                                    25 ( 5%)        âš¡-100.0% Â±  0.3%
  cache_misses       1.88K  Â±  506                                1.38K  â€¦ 9.15K                                    18 ( 4%)        âš¡-100.0% Â±  0.0%
  branch_misses      44.1K  Â± 3.04K                               42.8K  â€¦ 68.7K                                    44 ( 9%)        âš¡- 97.9% Â±  1.8%
Benchmark 4 (5 runs): ./narser/bin/narser cat linux.nar /README -L
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.12s  Â± 2.18ms                              1.11s  â€¦ 1.12s                                     0 ( 0%)        âš¡- 54.7% Â±  0.5%
  peak_rss           1.86GB Â± 58.6KB                              1.85GB â€¦ 1.86GB                                    1 (20%)        âš¡- 50.2% Â±  0.0%
  cpu_cycles          359M  Â±  943K                                357M  â€¦  360M                                     0 ( 0%)        âš¡- 85.4% Â±  0.8%
  instructions        419M  Â± 66.0                                 419M  â€¦  419M                                     0 ( 0%)        âš¡- 63.1% Â±  0.0%
  cache_references   9.83M  Â±  173K                               9.54M  â€¦ 10.0M                                     1 (20%)        âš¡- 92.4% Â±  3.7%
  cache_misses       1.69M  Â± 4.84K                               1.68M  â€¦ 1.70M                                     1 (20%)        âš¡- 97.6% Â±  0.2%
  branch_misses       689K  Â± 11.1K                                673K  â€¦  703K                                     0 ( 0%)        âš¡- 67.3% Â± 25.6%
Benchmark 5 (64 runs): ./nix-nar/bin/nix-nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          78.2ms Â± 1.96ms                              76.7ms â€¦ 86.1ms                                    6 ( 9%)        âš¡- 96.8% Â±  0.1%
  peak_rss           2.40MB Â± 72.6KB                              2.27MB â€¦ 2.55MB                                    0 ( 0%)        âš¡- 99.9% Â±  0.0%
  cpu_cycles          114M  Â± 3.56M                                112M  â€¦  130M                                    10 (16%)        âš¡- 95.3% Â±  0.2%
  instructions        164M  Â± 10.2K                                164M  â€¦  164M                                     0 ( 0%)        âš¡- 85.6% Â±  0.0%
  cache_references   1.51M  Â±  469K                                696K  â€¦ 3.21M                                     1 ( 2%)        âš¡- 98.8% Â±  0.9%
  cache_misses       22.4K  Â± 3.82K                               19.4K  â€¦ 36.1K                                     6 ( 9%)        âš¡-100.0% Â±  0.0%
  branch_misses       139K  Â± 70.8K                                107K  â€¦  449K                                     8 (13%)        âš¡- 93.4% Â±  6.5%
Benchmark 6 (3 runs): ./narz/bin/narz cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.07s  Â± 3.74ms                              3.07s  â€¦ 3.07s                                     0 ( 0%)        ðŸ’©+ 24.6% Â±  0.7%
  peak_rss           1.84GB Â± 75.7KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 50.7% Â±  0.0%
  cpu_cycles         1.00G  Â± 3.52M                               1.00G  â€¦ 1.01G                                     0 ( 0%)        âš¡- 59.0% Â±  1.3%
  instructions       1.36G  Â± 11.2K                               1.36G  â€¦ 1.36G                                     0 ( 0%)        ðŸ’©+ 19.4% Â±  0.0%
  cache_references   4.98M  Â±  479K                               4.43M  â€¦ 5.27M                                     0 ( 0%)        âš¡- 96.1% Â±  5.8%
  cache_misses        165K  Â±  582                                 165K  â€¦  166K                                     0 ( 0%)        âš¡- 99.8% Â±  0.4%
  branch_misses      1.92M  Â± 26.3K                               1.89M  â€¦ 1.94M                                     0 ( 0%)          -  9.1% Â± 39.9%

./nix/bin/nix-store --restore out < linux.nar
cmp <(./nix/bin/nix nar pack out) linux.nar
rm -rf out

./lix/bin/nix-store --restore out < linux.nar
cmp <(./nix/bin/nix nar pack out) linux.nar
rm -rf out

./narser/bin/narser unpack linux.nar out
cmp <(./nix/bin/nix nar pack out) linux.nar || exit 1
rm -rf out

rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.521s
user	0m0.334s
sys	0m1.177s
rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.555s
user	0m0.356s
sys	0m1.187s
rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.512s
user	0m0.333s
sys	0m1.173s

rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.657s
user	0m0.441s
sys	0m1.209s
rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.656s
user	0m0.484s
sys	0m1.166s
rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.664s
user	0m0.471s
sys	0m1.186s

rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.383s
user	0m0.217s
sys	0m1.159s
rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.386s
user	0m0.214s
sys	0m1.165s
rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.384s
user	0m0.243s
sys	0m1.134s
