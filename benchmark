
echo $1
/tmp/clevor/tests/

mkdir $1 || exit 1
cd $1

nix build git+https://git.lix.systems/lix-project/lix?rev=2a622d7de75bc7e228d862cf5bc379c91f38b76c -o lix >& /dev/null || exit 1
nix build github:NixOS/nix/07b96c1d14ab8695e5071fb73e19049fce8f3b6b -o nix >& /dev/null || exit 1
nix build github:water-sucks/narz/760736b98e08c7c741838f5ad020d6d2e33b5e57 -o narz >& /dev/null || exit 1
nix build github:myclevorname/narser/80a706458098dfef457fc0289010b027db433b14 -o narser >& /dev/null || exit 1

git clone https://github.com/torvalds/linux --depth=1 -q
cd linux
git log | head
commit 0903d0985ab0bb4f41bf611f686af1791d0301e4
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Fri Sep 19 11:39:26 2025 -0700

    Merge tag 'gpio-fixes-for-v6.17-rc7' of git://git.kernel.org/pub/scm/linux/kernel/git/brgl/linux
    
    Pull gpio fixes from Bartosz Golaszewski:
    
     - fix an ACPI I2C HID driver breakage due to not initializing a
       structure on the stack and passing garbage down to GPIO core
cd ..

nix nar pack linux > linux.nar

cmp <(./nix/bin/nix nar pack linux) <(./lix/bin/nix nar dump-path linux)
cmp <(./nix/bin/nix nar pack linux) <(./narser/bin/narser pack linux) || exit 1

cmp <(./nix/bin/nix nar cat linux.nar /README) <(./lix/bin/nix nar cat linux.nar /README)
cmp <(./nix/bin/nix nar cat linux.nar /README) <(./narser/bin/narser cat linux.nar /README) || exit 1
cmp <(./nix/bin/nix nar cat linux.nar /README) <(./narz/bin/narz cat linux.nar /README)

cmp <(./nix/bin/nix nar ls linux.nar /) <(./lix/bin/nix nar ls linux.nar /)
cmp <(./nix/bin/nix nar ls linux.nar /) <(./narser/bin/narser ls linux.nar /) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar /) <(./narz/bin/narz ls linux.nar / 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 1, line 1

cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./lix/bin/nix nar ls linux.nar / -l)
cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./narser/bin/narser ls linux.nar / -l) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./narz/bin/narz ls linux.nar / -l 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 1, line 1

cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./lix/bin/nix nar ls linux.nar / -lR)
cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./narser/bin/narser ls linux.nar / -lR) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./narz/bin/narz ls linux.nar / -lr 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 3, line 1

cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./lix/bin/nix nar ls linux.nar / -R)
error: writing to file: Broken pipe
cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./narser/bin/narser ls linux.nar / -R) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./narz/bin/narz ls linux.nar / -r 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 2, line 1

poop "./nix/bin/nix nar pack linux" "./lix/bin/nix nar dump-path linux" "./narser/bin/narser pack linux"
error: writing to file: Broken pipe
Benchmark 1 (3 runs): ./nix/bin/nix nar pack linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.89s  Â± 18.5ms                              1.87s  â€¦ 1.90s                                     0 ( 0%)        0%
  peak_rss           40.2MB Â±  171KB                              40.0MB â€¦ 40.3MB                                    0 ( 0%)        0%
  cpu_cycles         3.42G  Â± 43.3M                               3.37G  â€¦ 3.45G                                     0 ( 0%)        0%
  instructions       7.38G  Â±  192K                               7.38G  â€¦ 7.38G                                     0 ( 0%)        0%
  cache_references   54.4M  Â± 1.01M                               53.3M  â€¦ 55.2M                                     0 ( 0%)        0%
  cache_misses       4.69M  Â±  290K                               4.49M  â€¦ 5.03M                                     0 ( 0%)        0%
  branch_misses      9.54M  Â±  927K                               8.47M  â€¦ 10.1M                                     0 ( 0%)        0%
Benchmark 2 (5 runs): ./lix/bin/nix nar dump-path linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.15s  Â± 14.5ms                              1.14s  â€¦ 1.18s                                     0 ( 0%)        âš¡- 38.8% Â±  1.5%
  peak_rss           33.4MB Â±  131KB                              33.2MB â€¦ 33.6MB                                    0 ( 0%)        âš¡- 16.9% Â±  0.6%
  cpu_cycles         1.32G  Â± 20.0M                               1.30G  â€¦ 1.35G                                     0 ( 0%)        âš¡- 61.4% Â±  1.6%
  instructions       1.81G  Â± 7.04K                               1.81G  â€¦ 1.81G                                     0 ( 0%)        âš¡- 75.5% Â±  0.0%
  cache_references   83.2M  Â± 3.00M                               78.2M  â€¦ 85.6M                                     1 (20%)        ðŸ’©+ 52.9% Â±  8.3%
  cache_misses        848K  Â± 91.5K                                764K  â€¦  964K                                     0 ( 0%)        âš¡- 81.9% Â±  7.0%
  branch_misses      3.63M  Â±  421K                               3.18M  â€¦ 4.18M                                     0 ( 0%)        âš¡- 62.0% Â± 11.9%
Benchmark 3 (7 runs): ./narser/bin/narser pack linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           738ms Â± 16.3ms                               729ms â€¦  775ms                                    0 ( 0%)        âš¡- 60.8% Â±  1.4%
  peak_rss           1.57MB Â±    0                                1.57MB â€¦ 1.57MB                                    0 ( 0%)        âš¡- 96.1% Â±  0.3%
  cpu_cycles          195M  Â± 5.94M                                191M  â€¦  208M                                     0 ( 0%)        âš¡- 94.3% Â±  1.0%
  instructions        327M  Â± 5.19K                                327M  â€¦  327M                                     0 ( 0%)        âš¡- 95.6% Â±  0.0%
  cache_references   7.09M  Â±  945K                               6.04M  â€¦ 8.15M                                     0 ( 0%)        âš¡- 87.0% Â±  2.8%
  cache_misses        215K  Â± 69.7K                                172K  â€¦  371K                                     0 ( 0%)        âš¡- 95.4% Â±  5.3%
  branch_misses       727K  Â± 5.09K                                721K  â€¦  737K                                     0 ( 0%)        âš¡- 92.4% Â±  7.7%
poop "./nix/bin/nix nar ls linux.nar /" "./lix/bin/nix nar ls linux.nar /" "./narser/bin/narser ls linux.nar /" "./narz/bin/narz ls linux.nar /"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.52s  Â± 5.72ms                              2.51s  â€¦ 2.53s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â±  131KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.49G  Â± 11.3M                               2.48G  â€¦ 2.50G                                     0 ( 0%)        0%
  instructions       1.21G  Â± 98.5K                               1.21G  â€¦ 1.21G                                     0 ( 0%)        0%
  cache_references    132M  Â±  848K                                131M  â€¦  133M                                     0 ( 0%)        0%
  cache_misses       71.0M  Â±  139K                               70.9M  â€¦ 71.2M                                     0 ( 0%)        0%
  branch_misses      2.11M  Â±  327K                               1.73M  â€¦ 2.33M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.62s  Â± 7.06ms                              2.61s  â€¦ 2.63s                                     0 ( 0%)        ðŸ’©+  4.0% Â±  0.6%
  peak_rss           3.73GB Â± 88.9KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         2.89G  Â± 18.0M                               2.88G  â€¦ 2.91G                                     0 ( 0%)        ðŸ’©+ 16.2% Â±  1.4%
  instructions       2.16G  Â± 7.86K                               2.16G  â€¦ 2.16G                                     0 ( 0%)        ðŸ’©+ 79.4% Â±  0.0%
  cache_references    131M  Â±  413K                                131M  â€¦  132M                                     0 ( 0%)          -  0.5% Â±  1.1%
  cache_misses       70.4M  Â±  172K                               70.2M  â€¦ 70.6M                                     0 ( 0%)          -  0.9% Â±  0.5%
  branch_misses      4.20M  Â±  515K                               3.81M  â€¦ 4.78M                                     0 ( 0%)        ðŸ’©+ 99.1% Â± 46.4%
Benchmark 3 (46 runs): ./narser/bin/narser ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           109ms Â±  668us                               109ms â€¦  112ms                                    2 ( 4%)        âš¡- 95.7% Â±  0.1%
  peak_rss           33.5MB Â± 32.7KB                              33.4MB â€¦ 33.6MB                                    3 ( 7%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles         75.5M  Â±  850K                               74.9M  â€¦ 79.6M                                     4 ( 9%)        âš¡- 97.0% Â±  0.1%
  instructions        162M  Â±  187                                 162M  â€¦  162M                                     1 ( 2%)        âš¡- 86.5% Â±  0.0%
  cache_references    912K  Â± 19.5K                                887K  â€¦  967K                                     0 ( 0%)        âš¡- 99.3% Â±  0.2%
  cache_misses       14.7K  Â± 2.18K                               12.7K  â€¦ 25.7K                                     6 (13%)        âš¡-100.0% Â±  0.0%
  branch_misses       340K  Â± 3.35K                                337K  â€¦  351K                                     7 (15%)        âš¡- 83.9% Â±  3.9%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.65s  Â± 4.57ms                              3.65s  â€¦ 3.66s                                     0 ( 0%)        ðŸ’©+ 45.0% Â±  0.5%
  peak_rss           1.84GB Â± 75.7KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles          876M  Â± 5.04M                                870M  â€¦  880M                                     0 ( 0%)        âš¡- 64.8% Â±  0.8%
  instructions        864M  Â±  159                                 864M  â€¦  864M                                     0 ( 0%)        âš¡- 28.4% Â±  0.0%
  cache_references   4.57M  Â±  453K                               4.05M  â€¦ 4.89M                                     0 ( 0%)        âš¡- 96.5% Â±  1.2%
  cache_misses        138K  Â± 15.1K                                125K  â€¦  154K                                     0 ( 0%)        âš¡- 99.8% Â±  0.3%
  branch_misses      1.79M  Â± 8.74K                               1.78M  â€¦ 1.80M                                     0 ( 0%)          - 15.1% Â± 24.9%
poop "./nix/bin/nix nar ls linux.nar / -R" "./lix/bin/nix nar ls linux.nar / -R" "./narser/bin/narser ls linux.nar / -R" "./narz/bin/narz ls linux.nar / -r"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.74s  Â± 3.42ms                              2.73s  â€¦ 2.74s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â± 56.3KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.88G  Â± 25.2M                               2.86G  â€¦ 2.91G                                     0 ( 0%)        0%
  instructions       1.91G  Â±  427K                               1.91G  â€¦ 1.91G                                     0 ( 0%)        0%
  cache_references    140M  Â± 3.47M                                137M  â€¦  144M                                     0 ( 0%)        0%
  cache_misses       73.5M  Â±  158K                               73.4M  â€¦ 73.7M                                     0 ( 0%)        0%
  branch_misses      4.50M  Â±  839K                               3.91M  â€¦ 5.46M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.89s  Â± 19.4ms                              2.87s  â€¦ 2.91s                                     0 ( 0%)        ðŸ’©+  5.6% Â±  1.2%
  peak_rss           3.73GB Â±  111KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         3.37G  Â± 44.0M                               3.34G  â€¦ 3.42G                                     0 ( 0%)        ðŸ’©+ 17.1% Â±  2.8%
  instructions       3.01G  Â±  939K                               3.01G  â€¦ 3.01G                                     0 ( 0%)        ðŸ’©+ 57.8% Â±  0.1%
  cache_references    133M  Â± 1.66M                                132M  â€¦  135M                                     0 ( 0%)          -  4.7% Â±  4.4%
  cache_misses       71.1M  Â±  158K                               71.0M  â€¦ 71.3M                                     0 ( 0%)        âš¡-  3.3% Â±  0.5%
  branch_misses      6.18M  Â±  900K                               5.57M  â€¦ 7.21M                                     0 ( 0%)          + 37.4% Â± 43.9%
Benchmark 3 (38 runs): ./narser/bin/narser ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           132ms Â± 2.18ms                               130ms â€¦  138ms                                    1 ( 3%)        âš¡- 95.2% Â±  0.1%
  peak_rss           33.5MB Â± 29.7KB                              33.4MB â€¦ 33.6MB                                    2 ( 5%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles          153M  Â± 4.78M                                148M  â€¦  168M                                     2 ( 5%)        âš¡- 94.7% Â±  0.3%
  instructions        335M  Â±  149                                 335M  â€¦  335M                                     0 ( 0%)        âš¡- 82.4% Â±  0.0%
  cache_references   1.99M  Â± 36.1K                               1.88M  â€¦ 2.06M                                     3 ( 8%)        âš¡- 98.6% Â±  0.7%
  cache_misses        883K  Â± 28.7K                                786K  â€¦  927K                                     7 (18%)        âš¡- 98.8% Â±  0.1%
  branch_misses       498K  Â± 15.6K                                490K  â€¦  571K                                     6 (16%)        âš¡- 88.9% Â±  5.2%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar / -r
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.87s  Â± 6.01ms                              3.87s  â€¦ 3.88s                                     0 ( 0%)        ðŸ’©+ 41.4% Â±  0.4%
  peak_rss           1.84GB Â± 68.9KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles          965M  Â± 1.35M                                964M  â€¦  966M                                     0 ( 0%)        âš¡- 66.5% Â±  1.4%
  instructions        945M  Â± 96.7                                 945M  â€¦  945M                                     0 ( 0%)        âš¡- 50.4% Â±  0.0%
  cache_references   5.86M  Â± 78.5K                               5.80M  â€¦ 5.95M                                     0 ( 0%)        âš¡- 95.8% Â±  4.0%
  cache_misses        867K  Â± 5.69K                                862K  â€¦  873K                                     0 ( 0%)        âš¡- 98.8% Â±  0.3%
  branch_misses      2.15M  Â± 65.4K                               2.08M  â€¦ 2.21M                                     0 ( 0%)        âš¡- 52.1% Â± 30.0%
poop "./nix/bin/nix nar ls linux.nar / -Rl" "./lix/bin/nix nar ls linux.nar / -Rl" "./narser/bin/narser ls linux.nar / -Rl" "./narz/bin/narz ls linux.nar / -rl"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.84s  Â± 7.21ms                              2.83s  â€¦ 2.85s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â±  110KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         3.20G  Â± 48.0M                               3.16G  â€¦ 3.25G                                     0 ( 0%)        0%
  instructions       2.60G  Â± 2.50M                               2.59G  â€¦ 2.60G                                     0 ( 0%)        0%
  cache_references    142M  Â± 1.76M                                141M  â€¦  144M                                     0 ( 0%)        0%
  cache_misses       73.5M  Â±  353K                               73.1M  â€¦ 73.7M                                     0 ( 0%)        0%
  branch_misses      5.25M  Â± 1.28M                               4.30M  â€¦ 6.71M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.00s  Â± 19.9ms                              2.99s  â€¦ 3.03s                                     0 ( 0%)        ðŸ’©+  5.6% Â±  1.2%
  peak_rss           3.73GB Â±  245KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         3.81G  Â± 36.5M                               3.79G  â€¦ 3.85G                                     0 ( 0%)        ðŸ’©+ 19.1% Â±  3.0%
  instructions       3.89G  Â±  711K                               3.89G  â€¦ 3.89G                                     0 ( 0%)        ðŸ’©+ 49.8% Â±  0.2%
  cache_references    135M  Â± 2.94M                                133M  â€¦  139M                                     0 ( 0%)        âš¡-  5.1% Â±  3.9%
  cache_misses       71.2M  Â±  194K                               71.1M  â€¦ 71.4M                                     0 ( 0%)        âš¡-  3.2% Â±  0.9%
  branch_misses      7.39M  Â± 1.16M                               6.39M  â€¦ 8.66M                                     0 ( 0%)          + 40.6% Â± 52.8%
Benchmark 3 (38 runs): ./narser/bin/narser ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           135ms Â± 2.06ms                               133ms â€¦  141ms                                    1 ( 3%)        âš¡- 95.2% Â±  0.1%
  peak_rss           33.5MB Â± 40.8KB                              33.4MB â€¦ 33.6MB                                    4 (11%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles          162M  Â± 3.68M                                159M  â€¦  179M                                     4 (11%)        âš¡- 94.9% Â±  0.4%
  instructions        374M  Â±  278                                 374M  â€¦  374M                                     0 ( 0%)        âš¡- 85.6% Â±  0.0%
  cache_references   2.14M  Â± 32.9K                               1.98M  â€¦ 2.19M                                     1 ( 3%)        âš¡- 98.5% Â±  0.3%
  cache_misses        917K  Â± 28.7K                                784K  â€¦  998K                                     5 (13%)        âš¡- 98.8% Â±  0.1%
  branch_misses       538K  Â± 4.35K                                535K  â€¦  555K                                     5 (13%)        âš¡- 89.8% Â±  6.8%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar / -rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          5.06s  Â± 6.77ms                              5.05s  â€¦ 5.06s                                     0 ( 0%)        ðŸ’©+ 77.8% Â±  0.6%
  peak_rss           1.84GB Â± 40.2KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles         1.14G  Â± 5.93M                               1.14G  â€¦ 1.15G                                     0 ( 0%)        âš¡- 64.2% Â±  2.4%
  instructions       1.11G  Â± 53.7                                1.11G  â€¦ 1.11G                                     0 ( 0%)        âš¡- 57.2% Â±  0.2%
  cache_references   6.80M  Â±  878K                               5.84M  â€¦ 7.56M                                     0 ( 0%)        âš¡- 95.2% Â±  2.2%
  cache_misses        878K  Â± 10.9K                                870K  â€¦  890K                                     0 ( 0%)        âš¡- 98.8% Â±  0.8%
  branch_misses      2.53M  Â± 30.2K                               2.49M  â€¦ 2.56M                                     0 ( 0%)        âš¡- 51.9% Â± 39.2%
poop "./nix/bin/nix nar ls linux.nar / -l" "./lix/bin/nix nar ls linux.nar / -l" "./narser/bin/narser ls linux.nar / -l" "./narz/bin/narz ls linux.nar / -l"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.52s  Â± 4.52ms                              2.51s  â€¦ 2.52s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â± 96.3KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.48G  Â± 4.67M                               2.48G  â€¦ 2.48G                                     0 ( 0%)        0%
  instructions       1.21G  Â±  284K                               1.21G  â€¦ 1.21G                                     0 ( 0%)        0%
  cache_references    131M  Â± 2.13M                                128M  â€¦  133M                                     0 ( 0%)        0%
  cache_misses       71.2M  Â±  152K                               71.0M  â€¦ 71.3M                                     0 ( 0%)        0%
  branch_misses      1.77M  Â± 27.4K                               1.73M  â€¦ 1.79M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.62s  Â±  877us                              2.62s  â€¦ 2.62s                                     0 ( 0%)        ðŸ’©+  3.9% Â±  0.3%
  peak_rss           3.73GB Â±  245KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         2.87G  Â± 8.67M                               2.87G  â€¦ 2.88G                                     0 ( 0%)        ðŸ’©+ 15.9% Â±  0.6%
  instructions       2.16G  Â± 9.23K                               2.16G  â€¦ 2.16G                                     0 ( 0%)        ðŸ’©+ 79.3% Â±  0.0%
  cache_references    132M  Â± 2.99M                                129M  â€¦  135M                                     0 ( 0%)          +  0.8% Â±  4.5%
  cache_misses       70.4M  Â±  117K                               70.3M  â€¦ 70.5M                                     0 ( 0%)          -  1.1% Â±  0.4%
  branch_misses      3.90M  Â±  169K                               3.75M  â€¦ 4.08M                                     0 ( 0%)        ðŸ’©+121.0% Â± 15.5%
Benchmark 3 (46 runs): ./narser/bin/narser ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           110ms Â± 1.81ms                               109ms â€¦  116ms                                    3 ( 7%)        âš¡- 95.6% Â±  0.1%
  peak_rss           33.5MB Â± 41.2KB                              33.4MB â€¦ 33.6MB                                    5 (11%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles         75.4M  Â±  699K                               74.8M  â€¦ 77.5M                                     4 ( 9%)        âš¡- 97.0% Â±  0.1%
  instructions        162M  Â±  256                                 162M  â€¦  162M                                     2 ( 4%)        âš¡- 86.5% Â±  0.0%
  cache_references    929K  Â± 19.0K                                891K  â€¦  958K                                     0 ( 0%)        âš¡- 99.3% Â±  0.4%
  cache_misses       14.9K  Â± 2.04K                               12.1K  â€¦ 21.6K                                     4 ( 9%)        âš¡-100.0% Â±  0.1%
  branch_misses       341K  Â± 5.75K                                337K  â€¦  364K                                     6 (13%)        âš¡- 80.7% Â±  0.5%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.67s  Â± 8.33ms                              3.66s  â€¦ 3.68s                                     0 ( 0%)        ðŸ’©+ 45.6% Â±  0.6%
  peak_rss           1.84GB Â±    0                                1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles          875M  Â± 1.36M                                874M  â€¦  877M                                     0 ( 0%)        âš¡- 64.7% Â±  0.3%
  instructions        864M  Â± 91.9                                 864M  â€¦  864M                                     0 ( 0%)        âš¡- 28.4% Â±  0.0%
  cache_references   5.68M  Â±  389K                               5.24M  â€¦ 5.94M                                     0 ( 0%)        âš¡- 95.6% Â±  2.7%
  cache_misses        131K  Â± 5.53K                                126K  â€¦  137K                                     0 ( 0%)        âš¡- 99.8% Â±  0.3%
  branch_misses      1.82M  Â± 61.6K                               1.75M  â€¦ 1.86M                                     0 ( 0%)          +  3.2% Â±  6.1%
poop "./nix/bin/nix nar cat linux.nar /README" "./lix/bin/nix nar cat linux.nar /README" "./narser/bin/narser cat linux.nar /README" "./narz/bin/narz cat linux.nar /README"
Benchmark 1 (3 runs): ./nix/bin/nix nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.49s  Â± 12.7ms                              2.47s  â€¦ 2.49s                                     0 ( 0%)        0%
  peak_rss           3.73GB Â±  117KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)        0%
  cpu_cycles         2.43G  Â± 2.28M                               2.43G  â€¦ 2.44G                                     0 ( 0%)        0%
  instructions       1.14G  Â±  300K                               1.14G  â€¦ 1.14G                                     0 ( 0%)        0%
  cache_references    129M  Â±  885K                                128M  â€¦  130M                                     0 ( 0%)        0%
  cache_misses       70.0M  Â±  223K                               69.9M  â€¦ 70.3M                                     0 ( 0%)        0%
  branch_misses      1.65M  Â± 80.6K                               1.56M  â€¦ 1.72M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.62s  Â± 4.17ms                              2.62s  â€¦ 2.62s                                     0 ( 0%)        ðŸ’©+  5.4% Â±  0.9%
  peak_rss           3.73GB Â± 30.7KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          +  0.2% Â±  0.0%
  cpu_cycles         2.89G  Â± 17.8M                               2.87G  â€¦ 2.91G                                     0 ( 0%)        ðŸ’©+ 18.6% Â±  1.2%
  instructions       2.17G  Â± 2.51K                               2.17G  â€¦ 2.17G                                     0 ( 0%)        ðŸ’©+ 91.3% Â±  0.0%
  cache_references    132M  Â± 3.20M                                128M  â€¦  134M                                     0 ( 0%)          +  2.6% Â±  4.1%
  cache_misses       70.5M  Â±  201K                               70.3M  â€¦ 70.7M                                     0 ( 0%)          +  0.7% Â±  0.7%
  branch_misses      4.20M  Â±  445K                               3.93M  â€¦ 4.71M                                     0 ( 0%)        ðŸ’©+155.2% Â± 44.0%
Benchmark 3 (5 runs): ./narser/bin/narser cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.13s  Â± 3.93ms                              1.13s  â€¦ 1.14s                                     0 ( 0%)        âš¡- 54.4% Â±  0.6%
  peak_rss           1.86GB Â± 58.6KB                              1.85GB â€¦ 1.86GB                                    1 (20%)        âš¡- 50.2% Â±  0.0%
  cpu_cycles          354M  Â±  750K                                353M  â€¦  355M                                     0 ( 0%)        âš¡- 85.5% Â±  0.1%
  instructions        410M  Â± 43.3                                 410M  â€¦  410M                                     0 ( 0%)        âš¡- 63.9% Â±  0.0%
  cache_references   9.67M  Â±  548K                               9.24M  â€¦ 10.3M                                     0 ( 0%)        âš¡- 92.5% Â±  0.9%
  cache_misses       1.68M  Â± 4.46K                               1.68M  â€¦ 1.69M                                     0 ( 0%)        âš¡- 97.6% Â±  0.3%
  branch_misses       723K  Â± 2.64K                                720K  â€¦  726K                                     0 ( 0%)        âš¡- 56.0% Â±  5.1%
Benchmark 4 (3 runs): ./narz/bin/narz cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.64s  Â± 2.06ms                              3.64s  â€¦ 3.64s                                     0 ( 0%)        ðŸ’©+ 46.4% Â±  0.8%
  peak_rss           1.84GB Â±    0                                1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 50.7% Â±  0.0%
  cpu_cycles          873M  Â±  774K                                872M  â€¦  874M                                     0 ( 0%)        âš¡- 64.1% Â±  0.2%
  instructions        864M  Â± 56.3                                 864M  â€¦  864M                                     0 ( 0%)        âš¡- 24.0% Â±  0.0%
  cache_references   4.71M  Â± 40.5K                               4.68M  â€¦ 4.76M                                     0 ( 0%)        âš¡- 96.3% Â±  1.1%
  cache_misses        124K  Â± 1.49K                                123K  â€¦  125K                                     0 ( 0%)        âš¡- 99.8% Â±  0.5%
  branch_misses      1.77M  Â± 44.2K                               1.72M  â€¦ 1.80M                                     0 ( 0%)          +  7.7% Â±  9.0%

./nix/bin/nix-store --restore out < linux.nar
cmp <(./nix/bin/nix nar pack out) linux.nar
rm -rf out

./lix/bin/nix-store --restore out < linux.nar
cmp <(./nix/bin/nix nar pack out) linux.nar
rm -rf out

./narser/bin/narser unpack linux.nar out
cmp <(./nix/bin/nix nar pack out) linux.nar || exit 1
rm -rf out

rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.554s
user	0m0.349s
sys	0m1.192s
rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.537s
user	0m0.327s
sys	0m1.203s
rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.535s
user	0m0.335s
sys	0m1.194s

rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.689s
user	0m0.476s
sys	0m1.206s
rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.689s
user	0m0.481s
sys	0m1.201s
rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.703s
user	0m0.507s
sys	0m1.189s

rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.399s
user	0m0.229s
sys	0m1.163s
rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.408s
user	0m0.211s
sys	0m1.190s
rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.403s
user	0m0.219s
sys	0m1.178s
