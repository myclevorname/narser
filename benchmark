
echo $1
/tmp/clevor/tests/

mkdir $1 || exit 1
cd $1

nix build git+https://git.lix.systems/lix-project/lix?rev=3a4f9488f0a9ca46b22b38de7e0a760a9a63129a -o lix >& /dev/null || exit 1
nix build github:NixOS/nix/d8d1fb0e3495daee285b9796384f76cde32de08b -o nix >& /dev/null || exit 1
nix build git+https://git.sr.ht/~watersucks/narz?rev=760736b98e08c7c741838f5ad020d6d2e33b5e57 -o narz >& /dev/null || exit 1
nix build github:myclevorname/narser/d9688f8090b3e7f2cbc12295f099ddc135053121 -o narser >& /dev/null || exit 1
nix build gitlab:abstract-binary/nix-nar-rs/c8d9250b9be837abafa0046cb9c2a852b846da6a -o nix-nar >& /dev/null || exit 1

git clone https://github.com/torvalds/linux --depth=1 -q
cd linux
git log | head
commit cd89d487374c49f18a8c4af312ecc74d997f3b07
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Fri Sep 19 16:11:30 2025 -0700

    Merge tag '6.17-rc6-smb3-client-fixes' of git://git.samba.org/sfrench/cifs-2.6
    
    Pull smb client fixes from Steve French:
    
     - Two unlink fixes: one for rename and one for deferred close
    
cd ..

nix nar pack linux > linux.nar

cmp <(./nix/bin/nix nar pack linux) <(./lix/bin/nix nar dump-path linux)
cmp <(./nix/bin/nix nar pack linux) <(./narser/bin/narser pack linux) || exit 1
cmp <(./nix/bin/nix nar pack linux) <(./nix-nar/bin/nix-nar dump-path linux)

cmp <(./nix/bin/nix nar cat linux.nar /README) <(./lix/bin/nix nar cat linux.nar /README)
cmp <(./nix/bin/nix nar cat linux.nar /README) <(./narser/bin/narser cat linux.nar /README) || exit 1
cmp <(./nix/bin/nix nar cat linux.nar /README) <(./narz/bin/narz cat linux.nar /README)
cmp <(./nix/bin/nix nar cat linux.nar /README) <(./nix-nar/bin/nix-nar cat linux.nar /README)

cmp <(./nix/bin/nix nar ls linux.nar /) <(./lix/bin/nix nar ls linux.nar /)
cmp <(./nix/bin/nix nar ls linux.nar /) <(./narser/bin/narser ls linux.nar /) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / 2> /dev/null) <(./narz/bin/narz ls linux.nar / 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 1, line 1
cmp <(./nix/bin/nix nar ls linux.nar /) <(./nix-nar/bin/nix-nar ls linux.nar /)

cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./lix/bin/nix nar ls linux.nar / -l)
cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./narser/bin/narser ls linux.nar / -l) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -l 2> /dev/null) <(./narz/bin/narz ls linux.nar / -l 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 1, line 1
cmp <(./nix/bin/nix nar ls linux.nar / -l) <(./nix-nar/bin/nix-nar ls linux.nar / -l)

cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./lix/bin/nix nar ls linux.nar / -lR)
cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./narser/bin/narser ls linux.nar / -lR) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -lR 2> /dev/null) <(./narz/bin/narz ls linux.nar / -lr 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 3, line 1
cmp <(./nix/bin/nix nar ls linux.nar / -lR) <(./nix-nar/bin/nix-nar ls linux.nar / -lR)

cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./lix/bin/nix nar ls linux.nar / -R)
cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./narser/bin/narser ls linux.nar / -R) || exit 1
cmp <(./nix/bin/nix nar ls linux.nar / -R 2> /dev/null) <(./narz/bin/narz ls linux.nar / -r 2> /dev/null)
/dev/fd/63 /dev/fd/62 differ: byte 2, line 1
cmp <(./nix/bin/nix nar ls linux.nar / -R) <(./nix-nar/bin/nix-nar ls linux.nar / -R)


poop "./nix/bin/nix nar pack linux" "./lix/bin/nix nar dump-path linux" "./narser/bin/narser pack linux" "./nix-nar/bin/nix-nar dump-path linux"
Benchmark 1 (3 runs): ./nix/bin/nix nar pack linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.94s  Â± 72.3ms                              1.86s  â€¦ 1.98s                                     0 ( 0%)        0%
  peak_rss           40.0MB Â±  156KB                              39.9MB â€¦ 40.1MB                                    0 ( 0%)        0%
  cpu_cycles         3.64G  Â±  228M                               3.37G  â€¦ 3.80G                                     0 ( 0%)        0%
  instructions       7.38G  Â±  121K                               7.38G  â€¦ 7.38G                                     0 ( 0%)        0%
  cache_references   56.7M  Â± 2.66M                               54.9M  â€¦ 59.8M                                     0 ( 0%)        0%
  cache_misses       4.41M  Â± 52.4K                               4.36M  â€¦ 4.47M                                     0 ( 0%)        0%
  branch_misses      15.1M  Â± 5.64M                               8.62M  â€¦ 18.5M                                     0 ( 0%)        0%
Benchmark 2 (5 runs): ./lix/bin/nix nar dump-path linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.16s  Â± 37.4ms                              1.13s  â€¦ 1.22s                                     0 ( 0%)        âš¡- 40.3% Â±  4.8%
  peak_rss           33.4MB Â±  125KB                              33.2MB â€¦ 33.6MB                                    0 ( 0%)        âš¡- 16.6% Â±  0.6%
  cpu_cycles         1.36G  Â±  116M                               1.29G  â€¦ 1.56G                                     0 ( 0%)        âš¡- 62.7% Â±  8.0%
  instructions       1.81G  Â± 5.72K                               1.81G  â€¦ 1.81G                                     0 ( 0%)        âš¡- 75.5% Â±  0.0%
  cache_references   76.7M  Â± 1.33M                               74.9M  â€¦ 78.4M                                     0 ( 0%)        ðŸ’©+ 35.3% Â±  5.9%
  cache_misses        804K  Â± 64.7K                                742K  â€¦  886K                                     0 ( 0%)        âš¡- 81.8% Â±  2.5%
  branch_misses      5.16M  Â± 3.06M                               3.37M  â€¦ 10.6M                                     0 ( 0%)        âš¡- 65.9% Â± 48.5%
Benchmark 3 (7 runs): ./narser/bin/narser pack linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           725ms Â± 2.79ms                               722ms â€¦  730ms                                    0 ( 0%)        âš¡- 62.6% Â±  3.0%
  peak_rss           1.55MB Â± 49.5KB                              1.44MB â€¦ 1.57MB                                    1 (14%)        âš¡- 96.1% Â±  0.4%
  cpu_cycles          191M  Â± 1.73M                                189M  â€¦  193M                                     0 ( 0%)        âš¡- 94.8% Â±  5.0%
  instructions        327M  Â± 5.70K                                327M  â€¦  327M                                     0 ( 0%)        âš¡- 95.6% Â±  0.0%
  cache_references   6.06M  Â±  275K                               5.72M  â€¦ 6.47M                                     0 ( 0%)        âš¡- 89.3% Â±  3.8%
  cache_misses        173K  Â± 11.4K                                155K  â€¦  186K                                     0 ( 0%)        âš¡- 96.1% Â±  1.0%
  branch_misses       728K  Â± 5.45K                                723K  â€¦  739K                                     0 ( 0%)        âš¡- 95.2% Â± 29.6%
Benchmark 4 (4 runs): ./nix-nar/bin/nix-nar dump-path linux
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.55s  Â± 7.50ms                              1.54s  â€¦ 1.56s                                     0 ( 0%)        âš¡- 20.3% Â±  4.7%
  peak_rss           2.87MB Â± 87.0KB                              2.76MB â€¦ 2.97MB                                    0 ( 0%)        âš¡- 92.8% Â±  0.6%
  cpu_cycles          549M  Â± 12.7M                                535M  â€¦  566M                                     0 ( 0%)        âš¡- 84.9% Â±  7.8%
  instructions        829M  Â±  168K                                829M  â€¦  829M                                     0 ( 0%)        âš¡- 88.8% Â±  0.0%
  cache_references   10.9M  Â±  637K                               10.1M  â€¦ 11.5M                                     0 ( 0%)        âš¡- 80.8% Â±  6.1%
  cache_misses        392K  Â± 7.32K                                383K  â€¦  399K                                     0 ( 0%)        âš¡- 91.1% Â±  1.5%
  branch_misses      2.95M  Â±  359K                               2.63M  â€¦ 3.43M                                     0 ( 0%)        âš¡- 80.5% Â± 46.4%
poop "./nix/bin/nix nar ls linux.nar /" "./lix/bin/nix nar ls linux.nar /" "./narser/bin/narser ls linux.nar /" "./narz/bin/narz ls linux.nar /" "./nix-nar/bin/nix-nar ls linux.nar /"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.50s  Â± 53.8ms                              2.46s  â€¦ 2.56s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â± 52.0KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.58G  Â±  162M                               2.47G  â€¦ 2.77G                                     0 ( 0%)        0%
  instructions       1.21G  Â±  400K                               1.21G  â€¦ 1.21G                                     0 ( 0%)        0%
  cache_references    127M  Â±  906K                                126M  â€¦  128M                                     0 ( 0%)        0%
  cache_misses       70.9M  Â±  152K                               70.7M  â€¦ 71.0M                                     0 ( 0%)        0%
  branch_misses      4.56M  Â± 4.38M                               1.74M  â€¦ 9.61M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.57s  Â± 4.39ms                              2.57s  â€¦ 2.58s                                     0 ( 0%)          +  2.6% Â±  3.5%
  peak_rss           3.73GB Â± 47.2KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         2.88G  Â± 4.31M                               2.87G  â€¦ 2.88G                                     0 ( 0%)        ðŸ’©+ 11.4% Â± 10.1%
  instructions       2.16G  Â± 4.57K                               2.16G  â€¦ 2.16G                                     0 ( 0%)        ðŸ’©+ 79.3% Â±  0.1%
  cache_references    128M  Â±  903K                                127M  â€¦  129M                                     0 ( 0%)          +  0.3% Â±  1.6%
  cache_misses       70.4M  Â±  193K                               70.2M  â€¦ 70.6M                                     0 ( 0%)          -  0.6% Â±  0.6%
  branch_misses      3.87M  Â± 58.0K                               3.81M  â€¦ 3.93M                                     0 ( 0%)          - 15.2% Â± 153.7%
Benchmark 3 (47 runs): ./narser/bin/narser ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           107ms Â±  599us                               106ms â€¦  109ms                                    4 ( 9%)        âš¡- 95.7% Â±  0.5%
  peak_rss           33.5MB Â± 37.0KB                              33.4MB â€¦ 33.6MB                                    4 ( 9%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles         75.3M  Â±  743K                               74.8M  â€¦ 78.0M                                     5 (11%)        âš¡- 97.1% Â±  1.5%
  instructions        162M  Â±  229                                 162M  â€¦  162M                                     2 ( 4%)        âš¡- 86.5% Â±  0.0%
  cache_references    927K  Â± 14.0K                                897K  â€¦  957K                                     0 ( 0%)        âš¡- 99.3% Â±  0.2%
  cache_misses       14.4K  Â± 1.90K                               12.4K  â€¦ 20.6K                                     6 (13%)        âš¡-100.0% Â±  0.1%
  branch_misses       341K  Â± 5.83K                                337K  â€¦  371K                                     6 (13%)        âš¡- 92.5% Â± 23.6%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.61s  Â± 3.07ms                              3.61s  â€¦ 3.61s                                     0 ( 0%)        ðŸ’©+ 44.1% Â±  3.4%
  peak_rss           1.84GB Â± 75.7KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles          873M  Â±  984K                                872M  â€¦  874M                                     0 ( 0%)        âš¡- 66.2% Â± 10.0%
  instructions        864M  Â± 96.1                                 864M  â€¦  864M                                     0 ( 0%)        âš¡- 28.4% Â±  0.1%
  cache_references   4.84M  Â±  170K                               4.73M  â€¦ 5.04M                                     0 ( 0%)        âš¡- 96.2% Â±  1.2%
  cache_misses        130K  Â± 3.99K                                126K  â€¦  134K                                     0 ( 0%)        âš¡- 99.8% Â±  0.3%
  branch_misses      1.80M  Â± 8.94K                               1.79M  â€¦ 1.81M                                     0 ( 0%)          - 60.5% Â± 153.7%
Benchmark 5 (10 runs): ./nix-nar/bin/nix-nar ls linux.nar /
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           516ms Â± 6.57ms                               512ms â€¦  535ms                                    1 (10%)        âš¡- 79.4% Â±  1.4%
  peak_rss           2.40MB Â± 81.6KB                              2.28MB â€¦ 2.51MB                                    0 ( 0%)        âš¡- 99.9% Â±  0.0%
  cpu_cycles          938M  Â± 14.3M                                929M  â€¦  977M                                     1 (10%)        âš¡- 63.7% Â±  3.9%
  instructions       1.50G  Â± 81.1K                               1.50G  â€¦ 1.50G                                     0 ( 0%)        ðŸ’©+ 24.7% Â±  0.0%
  cache_references   8.32M  Â± 2.92M                               5.33M  â€¦ 15.5M                                     1 (10%)        âš¡- 93.5% Â±  3.0%
  cache_misses       67.2K  Â± 17.9K                               45.5K  â€¦ 98.6K                                     0 ( 0%)        âš¡- 99.9% Â±  0.1%
  branch_misses      1.16M  Â±  316K                                989K  â€¦ 2.02M                                     1 (10%)        âš¡- 74.7% Â± 59.9%
poop "./nix/bin/nix nar ls linux.nar / -R" "./lix/bin/nix nar ls linux.nar / -R" "./narser/bin/narser ls linux.nar / -R" "./narz/bin/narz ls linux.nar / -r" "./nix-nar/bin/nix-nar ls linux.nar / -R"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.69s  Â± 1.37ms                              2.69s  â€¦ 2.69s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â±  153KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.86G  Â± 20.8M                               2.85G  â€¦ 2.89G                                     0 ( 0%)        0%
  instructions       1.91G  Â±  231K                               1.91G  â€¦ 1.91G                                     0 ( 0%)        0%
  cache_references    136M  Â± 1.35M                                135M  â€¦  138M                                     0 ( 0%)        0%
  cache_misses       73.5M  Â±  197K                               73.3M  â€¦ 73.7M                                     0 ( 0%)        0%
  branch_misses      4.11M  Â±  421K                               3.79M  â€¦ 4.58M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.83s  Â± 14.6ms                              2.81s  â€¦ 2.84s                                     0 ( 0%)        ðŸ’©+  5.1% Â±  0.9%
  peak_rss           3.73GB Â±  183KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         3.37G  Â± 44.0M                               3.32G  â€¦ 3.40G                                     0 ( 0%)        ðŸ’©+ 17.7% Â±  2.7%
  instructions       3.01G  Â± 1.17M                               3.01G  â€¦ 3.01G                                     0 ( 0%)        ðŸ’©+ 57.9% Â±  0.1%
  cache_references    129M  Â±  623K                                128M  â€¦  130M                                     0 ( 0%)        âš¡-  5.2% Â±  1.8%
  cache_misses       71.1M  Â±  155K                               71.0M  â€¦ 71.3M                                     0 ( 0%)        âš¡-  3.3% Â±  0.5%
  branch_misses      6.25M  Â±  846K                               5.32M  â€¦ 6.97M                                     0 ( 0%)        ðŸ’©+ 52.1% Â± 36.9%
Benchmark 3 (38 runs): ./narser/bin/narser ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           132ms Â± 4.31ms                               128ms â€¦  146ms                                    3 ( 8%)        âš¡- 95.1% Â±  0.2%
  peak_rss           33.5MB Â± 44.9KB                              33.4MB â€¦ 33.6MB                                    5 (13%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles          152M  Â± 7.44M                                148M  â€¦  190M                                     4 (11%)        âš¡- 94.7% Â±  0.4%
  instructions        335M  Â±  228                                 335M  â€¦  335M                                     0 ( 0%)        âš¡- 82.4% Â±  0.0%
  cache_references   2.00M  Â± 28.6K                               1.92M  â€¦ 2.06M                                     0 ( 0%)        âš¡- 98.5% Â±  0.3%
  cache_misses        887K  Â± 12.7K                                828K  â€¦  908K                                     1 ( 3%)        âš¡- 98.8% Â±  0.1%
  branch_misses       504K  Â± 44.9K                                491K  â€¦  768K                                     5 (13%)        âš¡- 87.7% Â±  3.1%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar / -r
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.83s  Â± 13.9ms                              3.82s  â€¦ 3.85s                                     0 ( 0%)        ðŸ’©+ 42.3% Â±  0.8%
  peak_rss           1.84GB Â± 10.8KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles          966M  Â± 3.25M                                964M  â€¦  970M                                     0 ( 0%)        âš¡- 66.2% Â±  1.2%
  instructions        945M  Â±  611                                 945M  â€¦  945M                                     0 ( 0%)        âš¡- 50.4% Â±  0.0%
  cache_references   5.71M  Â± 92.7K                               5.60M  â€¦ 5.79M                                     0 ( 0%)        âš¡- 95.8% Â±  1.6%
  cache_misses        869K  Â± 5.16K                                864K  â€¦  874K                                     0 ( 0%)        âš¡- 98.8% Â±  0.4%
  branch_misses      2.16M  Â±  109K                               2.08M  â€¦ 2.29M                                     0 ( 0%)        âš¡- 47.3% Â± 17.0%
Benchmark 5 (8 runs): ./nix-nar/bin/nix-nar ls linux.nar / -R
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           634ms Â± 4.77ms                               632ms â€¦  646ms                                    1 (13%)        âš¡- 76.4% Â±  0.2%
  peak_rss           13.9MB Â± 55.8KB                              13.8MB â€¦ 13.9MB                                    0 ( 0%)        âš¡- 99.6% Â±  0.0%
  cpu_cycles         1.13G  Â± 10.9M                               1.12G  â€¦ 1.15G                                     1 (13%)        âš¡- 60.6% Â±  0.7%
  instructions       1.95G  Â± 70.9K                               1.95G  â€¦ 1.95G                                     0 ( 0%)        ðŸ’©+  2.3% Â±  0.0%
  cache_references   11.5M  Â± 1.66M                               9.23M  â€¦ 13.5M                                     0 ( 0%)        âš¡- 91.5% Â±  1.8%
  cache_misses        184K  Â± 13.6K                                168K  â€¦  210K                                     0 ( 0%)        âš¡- 99.8% Â±  0.2%
  branch_misses      1.66M  Â±  224K                               1.53M  â€¦ 2.19M                                     1 (13%)        âš¡- 59.5% Â± 10.4%
poop "./nix/bin/nix nar ls linux.nar / -Rl" "./lix/bin/nix nar ls linux.nar / -Rl" "./narser/bin/narser ls linux.nar / -Rl" "./narz/bin/narz ls linux.nar / -rl" "./nix-nar/bin/nix-nar ls linux.nar / -Rl"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.80s  Â± 5.81ms                              2.80s  â€¦ 2.81s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â± 55.9KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         3.21G  Â± 50.3M                               3.18G  â€¦ 3.27G                                     0 ( 0%)        0%
  instructions       2.60G  Â± 1.21M                               2.59G  â€¦ 2.60G                                     0 ( 0%)        0%
  cache_references    138M  Â± 1.41M                                136M  â€¦  139M                                     0 ( 0%)        0%
  cache_misses       73.4M  Â±  371K                               73.0M  â€¦ 73.8M                                     0 ( 0%)        0%
  branch_misses      5.51M  Â± 1.16M                               4.72M  â€¦ 6.85M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.00s  Â± 88.7ms                              2.95s  â€¦ 3.10s                                     0 ( 0%)        ðŸ’©+  7.1% Â±  5.1%
  peak_rss           3.73GB Â± 56.3KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         3.93G  Â±  288M                               3.76G  â€¦ 4.26G                                     0 ( 0%)        ðŸ’©+ 22.4% Â± 14.6%
  instructions       3.89G  Â±  793K                               3.89G  â€¦ 3.89G                                     0 ( 0%)        ðŸ’©+ 50.0% Â±  0.1%
  cache_references    131M  Â± 1.66M                                129M  â€¦  133M                                     0 ( 0%)        âš¡-  5.0% Â±  2.5%
  cache_misses       71.1M  Â± 82.9K                               71.0M  â€¦ 71.2M                                     0 ( 0%)        âš¡-  3.0% Â±  0.8%
  branch_misses      11.4M  Â± 7.17M                               6.73M  â€¦ 19.6M                                     0 ( 0%)          +106.2% Â± 211.1%
Benchmark 3 (38 runs): ./narser/bin/narser ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           134ms Â± 2.10ms                               132ms â€¦  138ms                                    0 ( 0%)        âš¡- 95.2% Â±  0.1%
  peak_rss           33.6MB Â±    0                                33.6MB â€¦ 33.6MB                                    0 ( 0%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles          162M  Â± 3.59M                                159M  â€¦  179M                                     9 (24%)        âš¡- 95.0% Â±  0.5%
  instructions        374M  Â±  195                                 374M  â€¦  374M                                     0 ( 0%)        âš¡- 85.6% Â±  0.0%
  cache_references   2.10M  Â± 27.7K                               1.96M  â€¦ 2.14M                                     1 ( 3%)        âš¡- 98.5% Â±  0.3%
  cache_misses        910K  Â± 22.9K                                781K  â€¦  944K                                     2 ( 5%)        âš¡- 98.8% Â±  0.1%
  branch_misses       538K  Â± 6.78K                                534K  â€¦  570K                                     5 (13%)        âš¡- 90.2% Â±  5.9%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar / -rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          5.02s  Â± 12.3ms                              5.01s  â€¦ 5.03s                                     0 ( 0%)        ðŸ’©+ 79.3% Â±  0.8%
  peak_rss           1.84GB Â± 76.1KB                              1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles         1.15G  Â± 11.5M                               1.14G  â€¦ 1.16G                                     0 ( 0%)        âš¡- 64.2% Â±  2.6%
  instructions       1.11G  Â±  588                                1.11G  â€¦ 1.11G                                     0 ( 0%)        âš¡- 57.2% Â±  0.1%
  cache_references   6.06M  Â±  210K                               5.84M  â€¦ 6.26M                                     0 ( 0%)        âš¡- 95.6% Â±  1.7%
  cache_misses        879K  Â± 6.98K                                871K  â€¦  885K                                     0 ( 0%)        âš¡- 98.8% Â±  0.8%
  branch_misses      2.64M  Â±  228K                               2.46M  â€¦ 2.90M                                     0 ( 0%)        âš¡- 52.1% Â± 34.5%
Benchmark 5 (8 runs): ./nix-nar/bin/nix-nar ls linux.nar / -Rl
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           668ms Â± 6.20ms                               660ms â€¦  676ms                                    0 ( 0%)        âš¡- 76.2% Â±  0.3%
  peak_rss           13.9MB Â± 48.0KB                              13.9MB â€¦ 14.0MB                                    0 ( 0%)        âš¡- 99.6% Â±  0.0%
  cpu_cycles         1.24G  Â± 17.9M                               1.22G  â€¦ 1.26G                                     0 ( 0%)        âš¡- 61.5% Â±  1.4%
  instructions       2.21G  Â± 78.8K                               2.21G  â€¦ 2.21G                                     0 ( 0%)        âš¡- 14.8% Â±  0.0%
  cache_references   12.0M  Â± 1.75M                               9.84M  â€¦ 15.2M                                     0 ( 0%)        âš¡- 91.2% Â±  1.9%
  cache_misses        297K  Â± 14.9K                                278K  â€¦  321K                                     0 ( 0%)        âš¡- 99.6% Â±  0.4%
  branch_misses      2.02M  Â±  355K                               1.66M  â€¦ 2.65M                                     0 ( 0%)        âš¡- 63.4% Â± 17.5%
poop "./nix/bin/nix nar ls linux.nar / -l" "./lix/bin/nix nar ls linux.nar / -l" "./narser/bin/narser ls linux.nar / -l" "./narz/bin/narz ls linux.nar / -l" "./nix-nar/bin/nix-nar ls linux.nar / -l"
Benchmark 1 (3 runs): ./nix/bin/nix nar ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.47s  Â± 14.4ms                              2.45s  â€¦ 2.48s                                     0 ( 0%)        0%
  peak_rss           3.75GB Â± 44.3KB                              3.75GB â€¦ 3.75GB                                    0 ( 0%)        0%
  cpu_cycles         2.49G  Â± 19.9M                               2.47G  â€¦ 2.51G                                     0 ( 0%)        0%
  instructions       1.21G  Â±  246K                               1.21G  â€¦ 1.21G                                     0 ( 0%)        0%
  cache_references    128M  Â± 3.93M                                125M  â€¦  132M                                     0 ( 0%)        0%
  cache_misses       71.1M  Â±  230K                               70.8M  â€¦ 71.3M                                     0 ( 0%)        0%
  branch_misses      2.17M  Â±  394K                               1.72M  â€¦ 2.47M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.57s  Â± 3.67ms                              2.56s  â€¦ 2.57s                                     0 ( 0%)        ðŸ’©+  4.0% Â±  1.0%
  peak_rss           3.73GB Â±  162KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          -  0.4% Â±  0.0%
  cpu_cycles         2.88G  Â± 14.6M                               2.87G  â€¦ 2.89G                                     0 ( 0%)        ðŸ’©+ 15.8% Â±  1.6%
  instructions       2.16G  Â± 11.5K                               2.16G  â€¦ 2.16G                                     0 ( 0%)        ðŸ’©+ 79.3% Â±  0.0%
  cache_references    128M  Â±  410K                                128M  â€¦  128M                                     0 ( 0%)          +  0.0% Â±  4.9%
  cache_misses       70.4M  Â± 42.1K                               70.4M  â€¦ 70.4M                                     0 ( 0%)          -  1.0% Â±  0.5%
  branch_misses      4.26M  Â±  354K                               3.85M  â€¦ 4.47M                                     0 ( 0%)        ðŸ’©+ 96.7% Â± 39.2%
Benchmark 3 (47 runs): ./narser/bin/narser ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           108ms Â± 1.77ms                               106ms â€¦  114ms                                    5 (11%)        âš¡- 95.6% Â±  0.2%
  peak_rss           33.5MB Â± 37.0KB                              33.4MB â€¦ 33.6MB                                    4 ( 9%)        âš¡- 99.1% Â±  0.0%
  cpu_cycles         75.2M  Â±  610K                               74.8M  â€¦ 77.2M                                     6 (13%)        âš¡- 97.0% Â±  0.2%
  instructions        162M  Â±  227                                 162M  â€¦  162M                                     3 ( 6%)        âš¡- 86.5% Â±  0.0%
  cache_references    908K  Â± 18.6K                                878K  â€¦  964K                                     1 ( 2%)        âš¡- 99.3% Â±  0.8%
  cache_misses       14.3K  Â± 1.74K                               12.4K  â€¦ 21.6K                                     5 (11%)        âš¡-100.0% Â±  0.1%
  branch_misses       341K  Â± 6.15K                                337K  â€¦  365K                                     6 (13%)        âš¡- 84.3% Â±  4.5%
Benchmark 4 (3 runs): ./narz/bin/narz ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.64s  Â± 7.26ms                              3.64s  â€¦ 3.65s                                     0 ( 0%)        ðŸ’©+ 47.5% Â±  1.0%
  peak_rss           1.84GB Â±    0                                1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 51.0% Â±  0.0%
  cpu_cycles          877M  Â± 3.21M                                874M  â€¦  880M                                     0 ( 0%)        âš¡- 64.8% Â±  1.3%
  instructions        864M  Â±  700                                 864M  â€¦  864M                                     0 ( 0%)        âš¡- 28.4% Â±  0.0%
  cache_references   4.54M  Â± 48.7K                               4.49M  â€¦ 4.58M                                     0 ( 0%)        âš¡- 96.5% Â±  4.9%
  cache_misses        127K  Â± 3.79K                                123K  â€¦  131K                                     0 ( 0%)        âš¡- 99.8% Â±  0.5%
  branch_misses      1.80M  Â± 78.9K                               1.75M  â€¦ 1.89M                                     0 ( 0%)          - 17.0% Â± 29.7%
Benchmark 5 (10 runs): ./nix-nar/bin/nix-nar ls linux.nar / -l
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time           538ms Â± 40.8ms                               514ms â€¦  633ms                                    0 ( 0%)        âš¡- 78.2% Â±  2.2%
  peak_rss           2.37MB Â± 39.3KB                              2.32MB â€¦ 2.44MB                                    0 ( 0%)        âš¡- 99.9% Â±  0.0%
  cpu_cycles         1.00G  Â±  131M                                932M  â€¦ 1.31G                                     0 ( 0%)        âš¡- 59.7% Â±  6.9%
  instructions       1.50G  Â± 78.2K                               1.50G  â€¦ 1.50G                                     0 ( 0%)        ðŸ’©+ 24.7% Â±  0.0%
  cache_references   10.6M  Â± 4.85M                               5.82M  â€¦ 23.0M                                     1 (10%)        âš¡- 91.7% Â±  5.3%
  cache_misses       62.1K  Â± 14.3K                               47.0K  â€¦ 91.5K                                     0 ( 0%)        âš¡- 99.9% Â±  0.2%
  branch_misses      2.78M  Â± 3.35M                                968K  â€¦ 10.6M                                     0 ( 0%)          + 28.4% Â± 202.8%
poop "./nix/bin/nix nar cat linux.nar /README" "./lix/bin/nix nar cat linux.nar /README" "./narser/bin/narser cat linux.nar /README" "./narz/bin/narz cat linux.nar /README" "./nix-nar/bin/nix-nar cat linux.nar /README"
Benchmark 1 (3 runs): ./nix/bin/nix nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.46s  Â± 13.6ms                              2.45s  â€¦ 2.47s                                     0 ( 0%)        0%
  peak_rss           3.73GB Â± 88.6KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)        0%
  cpu_cycles         2.43G  Â± 8.13M                               2.42G  â€¦ 2.44G                                     0 ( 0%)        0%
  instructions       1.14G  Â±  116K                               1.14G  â€¦ 1.14G                                     0 ( 0%)        0%
  cache_references    126M  Â± 4.01M                                124M  â€¦  131M                                     0 ( 0%)        0%
  cache_misses       69.9M  Â±  138K                               69.8M  â€¦ 70.0M                                     0 ( 0%)        0%
  branch_misses      1.71M  Â±  182K                               1.51M  â€¦ 1.87M                                     0 ( 0%)        0%
Benchmark 2 (3 runs): ./lix/bin/nix nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          2.58s  Â± 3.00ms                              2.58s  â€¦ 2.58s                                     0 ( 0%)        ðŸ’©+  4.8% Â±  0.9%
  peak_rss           3.73GB Â± 84.2KB                              3.73GB â€¦ 3.73GB                                    0 ( 0%)          +  0.2% Â±  0.0%
  cpu_cycles         2.89G  Â± 24.5M                               2.88G  â€¦ 2.92G                                     0 ( 0%)        ðŸ’©+ 18.8% Â±  1.7%
  instructions       2.17G  Â± 3.84K                               2.17G  â€¦ 2.17G                                     0 ( 0%)        ðŸ’©+ 91.3% Â±  0.0%
  cache_references    130M  Â± 2.66M                                128M  â€¦  133M                                     0 ( 0%)          +  3.0% Â±  6.1%
  cache_misses       70.2M  Â± 80.9K                               70.1M  â€¦ 70.2M                                     0 ( 0%)          +  0.4% Â±  0.4%
  branch_misses      4.26M  Â±  443K                               3.98M  â€¦ 4.78M                                     0 ( 0%)        ðŸ’©+148.9% Â± 44.8%
Benchmark 3 (5 runs): ./narser/bin/narser cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          1.11s  Â± 2.92ms                              1.11s  â€¦ 1.12s                                     0 ( 0%)        âš¡- 54.7% Â±  0.6%
  peak_rss           1.86GB Â± 58.6KB                              1.85GB â€¦ 1.86GB                                    1 (20%)        âš¡- 50.2% Â±  0.0%
  cpu_cycles          356M  Â± 1.53M                                354M  â€¦  357M                                     0 ( 0%)        âš¡- 85.4% Â±  0.4%
  instructions        410M  Â± 88.1                                 410M  â€¦  410M                                     0 ( 0%)        âš¡- 63.9% Â±  0.0%
  cache_references   9.66M  Â±  420K                               9.32M  â€¦ 10.4M                                     0 ( 0%)        âš¡- 92.3% Â±  3.3%
  cache_misses       1.70M  Â± 1.04K                               1.69M  â€¦ 1.70M                                     0 ( 0%)        âš¡- 97.6% Â±  0.2%
  branch_misses       738K  Â± 12.4K                                729K  â€¦  758K                                     0 ( 0%)        âš¡- 57.0% Â± 11.0%
Benchmark 4 (3 runs): ./narz/bin/narz cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          3.62s  Â± 6.82ms                              3.61s  â€¦ 3.62s                                     0 ( 0%)        ðŸ’©+ 47.1% Â±  1.0%
  peak_rss           1.84GB Â±    0                                1.84GB â€¦ 1.84GB                                    0 ( 0%)        âš¡- 50.7% Â±  0.0%
  cpu_cycles          872M  Â± 1.41M                                870M  â€¦  873M                                     0 ( 0%)        âš¡- 64.2% Â±  0.5%
  instructions        864M  Â± 11.4K                                864M  â€¦  864M                                     0 ( 0%)        âš¡- 23.9% Â±  0.0%
  cache_references   4.96M  Â±  531K                               4.62M  â€¦ 5.57M                                     0 ( 0%)        âš¡- 96.1% Â±  5.1%
  cache_misses        128K  Â± 4.08K                                124K  â€¦  131K                                     0 ( 0%)        âš¡- 99.8% Â±  0.3%
  branch_misses      1.79M  Â± 10.1K                               1.78M  â€¦ 1.80M                                     0 ( 0%)          +  4.6% Â± 17.0%
Benchmark 5 (66 runs): ./nix-nar/bin/nix-nar cat linux.nar /README
  measurement          mean Â± Ïƒ            min â€¦ max           outliers         delta
  wall_time          76.4ms Â±  501us                              75.6ms â€¦ 77.7ms                                    2 ( 3%)        âš¡- 96.9% Â±  0.1%
  peak_rss           2.40MB Â± 60.3KB                              2.30MB â€¦ 2.51MB                                    0 ( 0%)        âš¡- 99.9% Â±  0.0%
  cpu_cycles          113M  Â± 1.05M                                112M  â€¦  118M                                     5 ( 8%)        âš¡- 95.3% Â±  0.1%
  instructions        164M  Â± 9.91K                                164M  â€¦  164M                                     0 ( 0%)        âš¡- 85.6% Â±  0.0%
  cache_references   1.12M  Â±  279K                                653K  â€¦ 1.71M                                     0 ( 0%)        âš¡- 99.1% Â±  0.7%
  cache_misses       22.1K  Â± 3.22K                               19.9K  â€¦ 39.0K                                    10 (15%)        âš¡-100.0% Â±  0.0%
  branch_misses       119K  Â± 14.9K                                107K  â€¦  187K                                     4 ( 6%)        âš¡- 93.1% Â±  2.4%

./nix/bin/nix-store --restore out < linux.nar
cmp <(./nix/bin/nix nar pack out) linux.nar
rm -rf out

./lix/bin/nix-store --restore out < linux.nar
cmp <(./nix/bin/nix nar pack out) linux.nar
rm -rf out

./narser/bin/narser unpack linux.nar out
cmp <(./nix/bin/nix nar pack out) linux.nar || exit 1
rm -rf out

rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.522s
user	0m0.332s
sys	0m1.182s
rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.530s
user	0m0.340s
sys	0m1.183s
rm -rf out ; time ./nix/bin/nix-store --restore out < linux.nar

real	0m1.518s
user	0m0.367s
sys	0m1.144s

rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.662s
user	0m0.478s
sys	0m1.177s
rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.670s
user	0m0.484s
sys	0m1.179s
rm -rf out ; time ./lix/bin/nix-store --restore out < linux.nar

real	0m1.678s
user	0m0.501s
sys	0m1.170s

rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.384s
user	0m0.217s
sys	0m1.160s
rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.381s
user	0m0.221s
sys	0m1.153s
rm -rf out ; time ./narser/bin/narser unpack linux.nar out

real	0m1.379s
user	0m0.225s
sys	0m1.147s
